
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Animation &#8212; Coding for Economists</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/vis-animation.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Probability and Random Processes" href="econmt-probability-random.html" />
    <link rel="prev" title="Narrative Data Visualisation" href="vis-narrative.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/smith_lovelace.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Coding for Economists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coding
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="code-preliminaries.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-basics.html">
   Basics of Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-where.html">
   Options for Writing Code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-best-practice.html">
   Tips for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advcd-best-practice.html">
   Tools for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advanced.html">
   Advanced Coding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data-analysis-quickstart.html">
   Data Analysis Quickstart
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-intro.html">
   Working with Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-exploratory-analysis.html">
   Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-read-and-write.html">
   Reading and Writing Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-extraction.html">
   Getting Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-sharing.html">
   Sharing Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-advanced.html">
   Advanced Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Visualisation
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="vis-intro.html">
   Intro to Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-common-plots.html">
   Common Plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-narrative.html">
   Narrative Data Visualisation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Animation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-probability-random.html">
   Probability and Random Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-statistics.html">
   Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-causal-inference.html">
   Causal Inference
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Text Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="text-intro.html">
   Introduction to Text
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-nlp.html">
   Natural Language Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time-intro.html">
   Introduction to Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-series.html">
   Time Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-fcasts-env.html">
   Forecasting Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Workflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-research-outputs.html">
   Automating Research Outputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-command-line.html">
   The Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-rap.html">
   Reproducible Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Geospatial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="geo-intro.html">
   Intro to Geo-Spatial Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geo-vis.html">
   Geo-Spatial Visualisation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematics with Code
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="maths-maths-coding.html">
   Intro to Mathematics with Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coming from ...
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-stata.html">
   Coming from Stata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-matlab.html">
   Coming from Matlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-r.html">
   Coming from R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-excel.html">
   Coming from Excel
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Elsewhere
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/vis-animation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/aeturrell/coding-for-economists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fvis-animation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/aeturrell/coding-for-economists/main?urlpath=tree/vis-animation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/vis-animation.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-to-animate">
   Plot To Animate
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-animations-using-the-gif-package">
   Creating Animations Using the
   <strong>
    Gif
   </strong>
   Package
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#making-animations-using-the-imagio-package">
   Making Animations Using the
   <strong>
    imagio
   </strong>
   Package
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#see-also">
   See Also
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="animation">
<h1>Animation<a class="headerlink" href="#animation" title="Permalink to this headline">¶</a></h1>
<p>Animations can be an effective way to show an extra dimension of your data, especially changes over time. Clearly, they’re not appropriate everywhere, eg in static media! For various reasons, they should be used sparingly, but-used rarely and with care-they can convey a message about data more effectively than a static chart ever would. Perhaps the most famous example of an animated chart is the legendary Hans Roslings’ <a class="reference external" href="https://youtu.be/jbkSRLYSojo?t=29">gapminder animation</a> covering 200 countries and 200 years of progress in income and health.</p>
<p>The most common scenario for wanting to create an animation is sharing on social media (gifs are ubiquitous on the internet) or displaying an animation of some of your results during a talk. In both these cases, creating a gif is probably the best and safest option. ‘The best’ because although video files tend to be very large (and thus difficult to share), gifs can be turned into small files, with a bit of tweaking. ‘The safest’ because even though presentation software like Microsoft’s Powerpoint can crumble when trying to play an embedded video file, gifs usually work just fine. And while video formats differ across operating systems, all of them will play gifs (all you need to play a gif is a browser such as Safari or Chrome).  However, you can also create animations in other video formats, such as .mp4. The main downside of gifs is that they can produce quite jerky videos.</p>
<p>There are several ways to produce animations in Python, which we’ll come to in a moment. First though, let’s import some of the general packages we’ll need:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Settings</span>
<span class="c1"># Set max rows displayed for readability</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="c1"># Plot settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/aeturrell/coding-for-economists/raw/main/plot_style.txt&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="plot-to-animate">
<h2>Plot To Animate<a class="headerlink" href="#plot-to-animate" title="Permalink to this headline">¶</a></h2>
<p>First, we need a plot to animate. And what better dataset than the gapminder data? “There is none!” I hear you shout at your computer. But hang on, perhaps we’d better see a simple demonstration of some of the principles we’ll be using first.</p>
<p>A video is a sequence of static images stitched together and replayed quickly, like a flickbook cartoon. We will use the same trick, a series of static images played after one another, to create animated charts. But this means we need to create the series of static images.</p>
<p>Let’s create individual images and index them with <span class="math notranslate nohighlight">\(i\)</span>. We want to move on to a new scene every time we increment <span class="math notranslate nohighlight">\(i\)</span>. We do this by creating a <em>function</em> that accepts <span class="math notranslate nohighlight">\(i\)</span> as a parameter and that modifies what is shown on the image. The below example shows how it can work: although the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> arrays are always defined, and an <span class="math notranslate nohighlight">\(x\)</span>-<span class="math notranslate nohighlight">\(y\)</span> line plot is always shown, the <code class="docutils literal notranslate"><span class="pre">ax.scatter</span></code> function is passed only the <span class="math notranslate nohighlight">\(i\)</span>th element of the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> arrays. When we call <code class="docutils literal notranslate"><span class="pre">plot_scene</span></code> with different values of <span class="math notranslate nohighlight">\(i\)</span>, the scene updates to the next moment in time. In the example below, the bead moves along 1/20th of its journey between 0 and <span class="math notranslate nohighlight">\(2\pi\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_scene</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1"># Create an array</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="c1"># Create the y function</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scene </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">plot_scene</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plot_scene</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vis-animation_3_0.png" src="_images/vis-animation_3_0.png" />
<img alt="_images/vis-animation_3_1.png" src="_images/vis-animation_3_1.png" />
</div>
</div>
<p>Okay, so that’s the basic idea: a function of the scene that we can move forward through time. Later, we’ll stitch together the independent images. For now, let’s turn back to the gapminder data.</p>
<p>The gapminder data are from the excellent <a class="reference external" href="https://ourworldindata.org/">Our World in Data</a> website, but they’ve been filtered a bit for this book. Let’s load them up:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/aeturrell/coding-for-economists/raw/main/data/owid_gapminder.csv&quot;</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Year</th>
      <th>Life expectancy</th>
      <th>GDP per capita</th>
      <th>Population</th>
      <th>Continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1958</td>
      <td>31.403</td>
      <td>1298.0</td>
      <td>8680000.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1959</td>
      <td>31.925</td>
      <td>1307.0</td>
      <td>8834000.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1960</td>
      <td>32.446</td>
      <td>1326.0</td>
      <td>8997000.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1961</td>
      <td>32.962</td>
      <td>1309.0</td>
      <td>9169000.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>33.471</td>
      <td>1302.0</td>
      <td>9351000.0</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Brilliant, that’s our data. But now we need a plot, with a few dimensions of data, and a way to progress that plot through time.</p>
<p>Let’s first setup the end phase of our plot, where we’ll eventually get to. This will be based on the final year in the data.</p>
<p>There are five dimensions displayed in the plot we’re recreating:</p>
<ul class="simple">
<li><p>continent, via colour</p></li>
<li><p>income (GDP per capita), on the x-axis</p></li>
<li><p>life expectancy, on the y-axis</p></li>
<li><p>population, as bubble size</p></li>
<li><p>year, as the time dimension</p></li>
</ul>
<p>We have almost all of those columns already, but we do need to convert the list of <em>continents</em> to a list of <em>colours</em>. <strong>matplotlib</strong> has a built-in colour cycler, that we can use for this purpose. It is accessed via <code class="docutils literal notranslate"><span class="pre">plt.rcParams['axes.prop_cycle'].by_key()['color']</span></code>. To map the continents into colours, we’ll use a dictionary combined with the <code class="docutils literal notranslate"><span class="pre">zip</span></code> function that ‘zips’ two lists together (if the lists are unequal it takes the shorter and as there are only five continents in our data but ten colours, this will happen).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;#bc80bd&#39;, &#39;#fb8072&#39;, &#39;#b3de69&#39;, &#39;#fdb462&#39;, &#39;#fccde5&#39;, &#39;#8dd3c7&#39;, &#39;#ffed6f&#39;, &#39;#bebada&#39;, &#39;#80b1d3&#39;, &#39;#ccebc5&#39;, &#39;#d9d9d9&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colour_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Continent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s2">&quot;color&quot;</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Continent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">colour_mapping</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Country</th>
      <th>Year</th>
      <th>Life expectancy</th>
      <th>GDP per capita</th>
      <th>Population</th>
      <th>Continent</th>
      <th>colour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1958</td>
      <td>31.403</td>
      <td>1298.0</td>
      <td>8680000.0</td>
      <td>Asia</td>
      <td>#bc80bd</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1959</td>
      <td>31.925</td>
      <td>1307.0</td>
      <td>8834000.0</td>
      <td>Asia</td>
      <td>#bc80bd</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1960</td>
      <td>32.446</td>
      <td>1326.0</td>
      <td>8997000.0</td>
      <td>Asia</td>
      <td>#bc80bd</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1961</td>
      <td>32.962</td>
      <td>1309.0</td>
      <td>9169000.0</td>
      <td>Asia</td>
      <td>#bc80bd</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>33.471</td>
      <td>1302.0</td>
      <td>9351000.0</td>
      <td>Asia</td>
      <td>#bc80bd</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Okay, so we have all we need for our plot! Now we need to make a function that plots this when passed an index that gets mapped into a year. Note that while we have every year of data here, that may not be true in general so it’s always safer to map an index to the years that <em>are</em> available using a dictionary like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">step_to_yr_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())),</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gapminder_at_year</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">gap_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the gapminder data for a given step&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;i must be an integer.&quot;</span><span class="p">)</span>
    <span class="c1"># Map steps into years</span>
    <span class="n">step_to_yr_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())),</span> <span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">step_to_yr_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;i is beyond range of number of years.&quot;</span><span class="p">)</span>
    <span class="c1"># Filtered version of data with only the relevant year</span>
    <span class="n">gdf_yr</span> <span class="o">=</span> <span class="n">gap_df</span><span class="p">[</span><span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">step_to_yr_map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;GDP per capita&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e3</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">],</span>
        <span class="n">c</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">],</span>
        <span class="n">s</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP per capita (1000s 2011 USD)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gapminder: </span><span class="si">{</span><span class="n">step_to_yr_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Test this out at the first step</span>
<span class="n">gapminder_at_year</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/vis-animation_12_0.png" src="_images/vis-animation_12_0.png" />
</div>
</div>
<p>We now have everything we need to create the individual scenes in our animation.</p>
</div>
<div class="section" id="creating-animations-using-the-gif-package">
<h2>Creating Animations Using the <strong>Gif</strong> Package<a class="headerlink" href="#creating-animations-using-the-gif-package" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/maxhumber/gif"><strong>gif</strong></a> package is here to make it as easy as possible to create gifs from a series of plot images created using <strong>matplotlib</strong>, <strong>altair</strong>, or <strong>plotly</strong>. (In principle, this should also work for <strong>plotnine</strong> as it’s built on top of <strong>matplotlib</strong>). To install it, use <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">gif</span></code> on the command line.</p>
<p><strong>gif</strong> works by using function decorators (you can learn more about these in the advanced coding chapter). These ‘decorate’ existing functions using an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> symbol and change their behaviour. In this case, the decorator is <code class="docutils literal notranslate"><span class="pre">&#64;git.frame</span></code> and it tells <strong>gif</strong> to remember this function as one frame of a gif.</p>
<p>Note that in the example below, we’ll make things a bit less high resolution and brief than we might optimally do, just to save on some file space.</p>
<p>A few tips:</p>
<ul class="simple">
<li><p>use a high resolution when creating the gif, as high as 900 dots per inch. In the below we use a quite large 400 dots per inch to save a bit of space but it still gives a hefty file size. However…</p></li>
<li><p>…you can use an optimizer to then shrink that finished high res gif down to a more respectable size. In the below, <a class="reference external" href="https://github.com/LucaCappelletti94/pygifsicle"><strong>pygifsicle</strong></a> is used to do this, a package that you will need to install separately. In our example, this takes the gif down to under 1MB.</p></li>
<li><p>repeate the last frame multiple times; it allows the viewer to see where your animation ended up and gives a break before looping around again.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gif</span>

<span class="nd">@gif</span><span class="o">.</span><span class="n">frame</span>
<span class="k">def</span> <span class="nf">gapminder_at_year</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">gap_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Plots the gapminder data for a given step</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;i must be an integer.&quot;</span><span class="p">)</span>
    <span class="c1"># Map steps into years</span>
    <span class="n">step_to_yr_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())),</span>
                              <span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">step_to_yr_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;i is beyond range of number of years.&quot;</span><span class="p">)</span>
    <span class="n">gdf_yr</span> <span class="o">=</span> <span class="n">gap_df</span><span class="p">[</span><span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">step_to_yr_map</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;GDP per capita&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">],</span>
               <span class="n">c</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;colour&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">gdf_yr</span><span class="p">[</span><span class="s2">&quot;Population&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span>
               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">gap_df</span><span class="p">[</span><span class="s2">&quot;Life expectancy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;GDP per capita (1000s 2011 USD)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Life expectancy (years)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gapminder: </span><span class="si">{</span><span class="n">step_to_yr_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># How many iterations do we want?</span>
<span class="n">total_num_years</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="c1"># Produce the frames. Here, I&#39;ll only do the last 20 years to make the gif small</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="n">gapminder_at_year</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_num_years</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">total_num_years</span><span class="p">)]</span>
<span class="c1"># A trick: repeat the last frame a few more times to let people see where the animation ends</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span> <span class="o">+</span> <span class="p">[</span><span class="n">gapminder_at_year</span><span class="p">(</span><span class="n">total_num_years</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="c1"># Save the animation</span>
<span class="n">gif</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;img/gapminder.gif&quot;</span><span class="p">),</span> <span class="n">duration</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="s2">&quot;frames&quot;</span><span class="p">)</span>
<span class="c1"># Optimize the animation to make it smaller (and therefore easier to share)</span>
<span class="kn">from</span> <span class="nn">pygifsicle</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="n">optimize</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;img/gapminder.gif&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><img alt="Gif of shortened gapminder sequence." src="https://github.com/aeturrell/coding-for-economists/raw/main/img/gapminder.gif" /></p>
<p>And there we have a (shortened and not-as-high-res-as-optimally) gapminder sequence! Can you spot the financial crisis?</p>
<p>A higher resolution run would smooth out that slightly roughened text. Now you’ve seen how it works, you can really run quite free with animations because, if you can draw it as a series of frames with matplotlib (and related libraries), plotly, or altair, you can animate it.</p>
<div class="admonition-exercises admonition">
<p class="admonition-title">Exercises</p>
<ol class="simple">
<li><p>Animate the bead on a sine curve we saw earlier using the <strong>gif</strong> package.</p></li>
<li><p>Animate the complete gapminder sequence, from first year of data to 2018.</p></li>
</ol>
</div>
</div>
<div class="section" id="making-animations-using-the-imagio-package">
<h2>Making Animations Using the <strong>imagio</strong> Package<a class="headerlink" href="#making-animations-using-the-imagio-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://imageio.readthedocs.io/en/stable/"><strong>imagio</strong></a> is an alternative package for making animations, and works in a slightly different way, with an intermediate step between creating the static images and weaving them into a video. However, it allows you to stitch together jpg files as well as png files.</p>
<p>Let’s imagine that you have a folder for temporary files called ‘scratch’ and a directory for finished gifs called ‘img’. The code below gives an example of how you would use <strong>imageio</strong> to create 20 frames of a video and then weave them together into a .gif:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imageio</span>


<span class="k">def</span> <span class="nf">frame</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scene </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Outputs files of name &quot;frame000.png&quot; etc., but you could use .jpg</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;scratch/frame</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">0&gt;3d</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">))</span>

<span class="c1"># Create the frames; this creates files within the &#39;scratch&#39; directory</span>
<span class="p">[</span><span class="n">frame</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;scratch&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.png&quot;</span><span class="p">))</span>
<span class="n">file_names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="c1"># Now create the gif in the img directory:</span>
<span class="n">writer</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;img/sin_bead.gif&quot;</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_file</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">append_data</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">pygifsicle</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="n">optimize</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;img/sin_bead.gif&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><img alt="Gif of point on sine curve made with imagio" src="https://github.com/aeturrell/coding-for-economists/raw/main/img/sin_bead.gif" /></p>
<p><strong>imagio</strong> can also write to .mp4 files if needed, and has a host of other features not covered here.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>There are some excellent other tools out there. The command line tool <a class="reference external" href="https://www.ffmpeg.org/"><strong>ffmpeg</strong></a> is worth a look if you need fancier video options than are provided by the two tools we’ve met.</p>
<p><a class="reference external" href="https://matplotlib.org/stable/api/animation_api.html"><strong>Matplotlib</strong></a> has a built-in animation feature too, though historically it has been a bit more tricky to use than tools like <strong>imagio</strong> or <strong>gif</strong>.</p>
<p><a class="reference external" href="https://ahlive.readthedocs.io/en/latest"><strong>ahlive</strong></a> is a really promising package that is still in early development. It integrates directly with <strong>pandas</strong> and has some easy-to-use features for making sophisticated looking animations in just a few lines of code.</p>
<p>Finally, the master of animation in Python-but with a <em>very</em> steep learning curve-is <a class="reference external" href="https://3b1b.github.io/manim/index.html"><strong>manim</strong></a>, which makes extremely professional-looking mathematical animations. As an example, take a look at <a class="reference external" href="https://www.youtube.com/watch?v=r6sGWTCMz2k&amp;ab_channel=3Blue1Brown">this video on Fourier Series</a> that was created with <strong>manim</strong>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="vis-narrative.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Narrative Data Visualisation</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="econmt-probability-random.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Probability and Random Processes</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Arthur Turrell<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            This book is available under an MIT license.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-189705534-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>