
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Working with Data &#8212; Coding for Economists</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/data-intro.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Exploratory Data Analysis" href="data-exploratory-analysis.html" />
    <link rel="prev" title="Data Analysis Quickstart" href="data-analysis-quickstart.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/smith_lovelace.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Coding for Economists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coding
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="code-preliminaries.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-basics.html">
   Basics of Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-where.html">
   Options for Writing Code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-best-practice.html">
   Tips for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advcd-best-practice.html">
   Tools for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advanced.html">
   Advanced Coding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data-analysis-quickstart.html">
   Data Analysis Quickstart
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Working with Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-exploratory-analysis.html">
   Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-read-and-write.html">
   Reading and Writing Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-extraction.html">
   Getting Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-sharing.html">
   Sharing Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-advanced.html">
   Advanced Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Visualisation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="vis-intro.html">
   Intro to Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-common-plots.html">
   Common Plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-narrative.html">
   Narrative Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-animation.html">
   Animation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-probability-random.html">
   Probability and Random Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-statistics.html">
   Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-causal-inference.html">
   Causal Inference
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Text Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="text-intro.html">
   Introduction to Text
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-regex.html">
   Regular Expressions, aka regex
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-nlp.html">
   Natural Language Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time-intro.html">
   Introduction to Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-series.html">
   Time Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-fcasts-env.html">
   Forecasting Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Workflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-research-outputs.html">
   Automating Research Outputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-command-line.html">
   The Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-rap.html">
   Reproducible Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Geospatial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="geo-intro.html">
   Intro to Geo-Spatial Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geo-vis.html">
   Geo-Spatial Visualisation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematics with Code
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="maths-maths-coding.html">
   Intro to Mathematics with Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coming from ...
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-stata.html">
   Coming from Stata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-matlab.html">
   Coming from Matlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-r.html">
   Coming from R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-excel.html">
   Coming from Excel
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Elsewhere
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/data-intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/aeturrell/coding-for-economists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fdata-intro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/aeturrell/coding-for-economists/main?urlpath=tree/data-intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/data-intro.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-tidy-data">
     Using tidy data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataframes-and-series">
   Dataframes and series
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#values-columns-and-index">
     Values, columns, and index
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datatypes">
   Datatypes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-variables">
     Categorical variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#accessing-and-slicing">
   Accessing and slicing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#operations-on-dataframes">
   Operations on dataframes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregation">
   Aggregation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#split-apply-and-combine">
   Split, apply, and combine
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-transform-apply-and-assign">
   Filter, transform, apply, and assign
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter">
     Filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform">
     Transform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply">
     Apply
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#assign">
     Assign
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#query-and-eval">
   Query and Eval
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#query">
     Query
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eval">
     Eval
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-series-resampling-and-rolling-windows">
   Time series, resampling, and rolling windows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advanced-method-chaining">
   Advanced: Method Chaining
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reshaping-data">
   Reshaping data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pivoting-data-from-tidy-to-err-untidy">
     Pivoting data from tidy to, err, untidy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#melt">
     Melt
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stack-and-unstack">
     Stack and unstack
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-dummies">
     Get dummies
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combining-data">
   Combining data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#concatenate">
     Concatenate
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge">
     Merge
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#advanced-alternatives-to-pandas">
   Advanced: alternatives to
   <strong>
    pandas
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datatable">
     Datatable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cudf">
     cuDF
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polars">
     Polars
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plydata">
     Plydata
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#datar">
     Datar
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#others">
     Others
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#review">
   Review
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="working-with-data">
<span id="id1"></span><h1>Working with Data<a class="headerlink" href="#working-with-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The previous chapter was just a quick tour of what can be done with a single tabular dataset (a ‘dataframe’). In this chapter, we’ll go deeper into working with data.</p>
<p>The ability to extract, clean, and analyse data is one of the core skills any economist needs. Fortunately, the (open source) tools that are available for data analysis have improved enormously in recent years, and working with them can be a delight–even the most badly formatted data can be beaten into shape.</p>
<p>In this chapter, you’ll get really good introduction to the <a class="reference external" href="https://pandas.pydata.org/"><strong>pandas</strong></a> package, the core data manipulation library in Python. The name is derived from ‘panel data’ but it’s suited to any tabular data, and can be used to work with more complex data structures too. We <em>won’t</em> cover reading in or writing data here; see the next chapter for that.</p>
<p>This chapter is hugely indebted to the fantastic <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/">Python Data Science Handbook</a> by Jake Vanderplas. Remember, if you get stuck with pandas, there is brilliant <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/index.html">documentation</a> and a fantastic set of <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/intro_tutorials/index.html">introductory tutorials</a> on their website. These notes are heavily indebted to those introductory tutorials.</p>
<p>This chapter uses the <strong>pandas</strong>, <strong>seaborn</strong>, and <strong>numpy</strong> packages. If you’re running this code, you may need to install these packages, which you can do using either <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">packagename</span></code> or <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">packagename</span></code> on your computer’s command line.  If you’re running this page in Google Colab, you can install new packages by running <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">packagename</span></code> in a new code cell but you will need to restart the Colab notebook for the change to take effect. There’s a brief guide on installing packages in the Chapter on <a class="reference internal" href="code-preliminaries.html#code-preliminaries"><span class="std std-ref">Preliminaries</span></a>.</p>
<div class="section" id="using-tidy-data">
<h3>Using tidy data<a class="headerlink" href="#using-tidy-data" title="Permalink to this headline">¶</a></h3>
<p>As an aside, if you’re working with tabular data, it’s good to try and use a so-called ‘tidy data’ format. This is data with one observation per row, and one variable per column, like so:</p>
<p><img alt="" src="https://d33wubrfki0l68.cloudfront.net/6f1ddb544fc5c69a2478e444ab8112fb0eea23f8/91adc/images/tidy-1.png" /></p>
<p>Tidy data aren’t going to be appropriate <em>every</em> time and in every case, but they’re a really, really good default for tabular data. Once you use it as your default, it’s easier to think about how to perform subsequent operations. Some plotting libraries, such as <strong>seaborn</strong>, take that your data are in tidy format as a given. And many operations that you can perform on dataframes (the objects that hold tabular data within many programming languages) are easier when you have tidy data. If you’re writing out data to file to share, putting it in tidy format is a really good idea.</p>
<p>Of course, <em>getting</em> your messy dataset into a tidy format may take a bit of work… but we’re about to enter the exciting world of coding for data analysis and the tools you’ll see in the rest of this chapter will help you to ‘wrangle’ even the most messy of datasets.</p>
<p>Having said that tidy data are great, and they are, one of standard data library <strong>pandas</strong>’ advantages relative to other data analysis libraries is that it isn’t <em>too</em> tied to tidy data and can navigate awkward non-tidy data manipulation tasks happily too.</p>
</div>
</div>
<div class="section" id="dataframes-and-series">
<h2>Dataframes and series<a class="headerlink" href="#dataframes-and-series" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with the absolute basics. The most basic <strong>pandas</strong> object is a dataframe. A DataFrame is a 2-dimensional data structure that can store data of different types (including characters, integers, floating point values, categorical data, even lists) in columns.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/01_table_dataframe.svg" /></p>
<p>We’ll now import some useful packages, set a random number seed (some examples use randomly generated data), set up some nice plot settings, and load a dataset.</p>
<p>We’ll look at a dataframe of the <em>penguins</em> dataset. To show just the first 5 rows, I’ll be using the <code class="docutils literal notranslate"><span class="pre">head()</span></code> method (there’s also a <code class="docutils literal notranslate"><span class="pre">tail()</span></code> method).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">PCG64</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set seed for reproducibility</span>
<span class="n">seed_for_prng</span> <span class="o">=</span> <span class="mi">78557</span>
<span class="n">prng</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="n">PCG64</span><span class="p">(</span><span class="n">seed_for_prng</span><span class="p">))</span>
<span class="c1"># Plot settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/aeturrell/coding-for-economists/raw/main/plot_style.txt&quot;</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;penguins&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What just happened? We loaded a pandas dataframe called <code class="docutils literal notranslate"><span class="pre">df</span></code> and showed its contents. You can see the column names in bold, and the index on the left hand side. Just to double check it <em>is</em> a pandas dataframe, we can call type on this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>pandas.core.frame.DataFrame
</pre></div>
</div>
</div>
</div>
<p>And if we want a bit more information about what we imported (including the datatypes of the columns):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 344 entries, 0 to 343
Data columns (total 7 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   species            344 non-null    object 
 1   island             344 non-null    object 
 2   bill_length_mm     342 non-null    float64
 3   bill_depth_mm      342 non-null    float64
 4   flipper_length_mm  342 non-null    float64
 5   body_mass_g        342 non-null    float64
 6   sex                333 non-null    object 
dtypes: float64(4), object(3)
memory usage: 18.9+ KB
</pre></div>
</div>
</div>
</div>
<p>Remember that everything in Python is an object, and our dataframe is no exception. Each dataframe is made up of a set of series that, in a dataframe, become columns: but you can turn a single series into a dataframe too.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/01_table_series.svg" /></p>
<p>Let’s see a couple of ways of creating some series from raw data:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From a list:</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">19.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># From a dictionary</span>
<span class="n">population_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;California&quot;</span><span class="p">:</span> <span class="mi">38332521</span><span class="p">,</span>
    <span class="s2">&quot;Texas&quot;</span><span class="p">:</span> <span class="mi">26448193</span><span class="p">,</span>
    <span class="s2">&quot;New York&quot;</span><span class="p">:</span> <span class="mi">19651127</span><span class="p">,</span>
    <span class="s2">&quot;Florida&quot;</span><span class="p">:</span> <span class="mi">19552860</span><span class="p">,</span>
    <span class="s2">&quot;Illinois&quot;</span><span class="p">:</span> <span class="mi">12882135</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">population_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     1.0
1     6.0
2    19.0
3     2.0
dtype: float64


California    38332521
Texas         26448193
New York      19651127
Florida       19552860
Illinois      12882135
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Note that in each case there is no column name (because this is a series, not a dataframe), and there <em>is</em> an index. The index is automatically created if we don’t specify it; in the third example, by passing a dictionary we implicitly asked for the index to be the locations we supplied.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Create a <strong>pandas</strong> series of ascending integers using the Python built-in <code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code> function.</p>
</div>
<p>If you ever need to get the data ‘out’ of a series or dataframe, you can just call the <code class="docutils literal notranslate"><span class="pre">values</span></code> method on the object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s2</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([38332521, 26448193, 19651127, 19552860, 12882135])
</pre></div>
</div>
</div>
</div>
<p>If you ever want to turn a series into a dataframe, just called <code class="docutils literal notranslate"><span class="pre">pd.DataFrame(series)</span></code> on it. Note that while series have an index and an object name (eg <code class="docutils literal notranslate"><span class="pre">s2</span></code> above), they don’t have any column labels because they only have one column.</p>
<p>Now let’s try creating our own dataframe with more than one column of data using a <em>dictionary</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">),</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>test</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>train</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>test</td>
      <td>foo</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>3</td>
      <td>train</td>
      <td>foo</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Remember, curly brackets in the format <code class="docutils literal notranslate"><span class="pre">{key:</span> <span class="pre">value}</span></code> denote a dictionary. In the above example, the <code class="docutils literal notranslate"><span class="pre">pd.DataFrame()</span></code> function understands that any single value entries in the dictionary that is passed, such as <code class="docutils literal notranslate"><span class="pre">{'A':</span> <span class="pre">1.}</span></code>, should be repeated as many times as are needed to match the longest series in the dictionary (4 in the above example).</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Using a dictionary structure like the one above, create a <strong>pandas</strong> dataframe from the series you created in the previous exercise so that the name of the column is ‘series’.</p>
</div>
<p>Another way to create dataframes is to pass a bunch of series (note that <code class="docutils literal notranslate"><span class="pre">index</span></code>, <code class="docutils literal notranslate"><span class="pre">columns</span></code>, and <code class="docutils literal notranslate"><span class="pre">dtype</span></code> are optional–you can just specify the data):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col0</th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
      <th>col5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>6.0</td>
      <td>7.0</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>12.0</td>
      <td>13.0</td>
      <td>14.0</td>
      <td>15.0</td>
      <td>16.0</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>18.0</td>
      <td>19.0</td>
      <td>20.0</td>
      <td>21.0</td>
      <td>22.0</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24.0</td>
      <td>25.0</td>
      <td>26.0</td>
      <td>27.0</td>
      <td>28.0</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>f</th>
      <td>30.0</td>
      <td>31.0</td>
      <td>32.0</td>
      <td>33.0</td>
      <td>34.0</td>
      <td>35.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">reshape</span></code> takes an input and puts it into a given shape (a 6 by 6 matrix in the above example).</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Create a <strong>pandas</strong> dataframe using the <code class="docutils literal notranslate"><span class="pre">data=</span></code>, <code class="docutils literal notranslate"><span class="pre">index=</span></code>, and <code class="docutils literal notranslate"><span class="pre">columns=</span></code> keyword arguments. The data should consist of one column with ascending integers from 0 to 5, the column name should be “series”, and the index should be the first 5 letters of the alphabet. Remember that the <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> keyword arguments expect an iterable of some kind (not just a string).</p>
</div>
<div class="section" id="values-columns-and-index">
<h3>Values, columns, and index<a class="headerlink" href="#values-columns-and-index" title="Permalink to this headline">¶</a></h3>
<p>You’ll have seen that there are three different things that make up a dataframe: the values that are in the cells, the column names, and the index. The column and index can take on values that are the same as the values in a dataframe do; string, int, float, datetime, and more. It’s pretty obvious what role the columns play: they keep track of the name of different sets of values. But for people who may have seen other dataframe-like libraries, the role played by the index may be less familiar. The easiest way to think about a <strong>pandas</strong> index is that it does for row values what the columns do for columnar values: it’s a way of keeping track of what individual roles are and it <em>doesn’t</em> get used for calculations (just as summing a column ignores the name of the row).</p>
<p>Here’s an example to show this. Let’s first create a simple dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;col0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">],</span>
        <span class="s2">&quot;col4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;row&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col0</th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>a</td>
      <td>alpha</td>
    </tr>
    <tr>
      <th>row1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>b</td>
      <td>gamma</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>b</td>
      <td>gamma</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>a</td>
      <td>gamma</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we add one to the integer columns in the dataframe, this is what we get (note we’re not saving the result because we don’t have an assignment step with an <code class="docutils literal notranslate"><span class="pre">=</span></code> sign):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;col0&quot;</span><span class="p">,</span> <span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col0</th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>row0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>row1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>row2</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>row3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s use <code class="docutils literal notranslate"><span class="pre">col0</span></code> as our index instead of the original labels we created and add one to the remaining numeric columns (this time assigning the result back to the original columns):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;col0&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[[</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
    </tr>
    <tr>
      <th>col0</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>a</td>
      <td>alpha</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>b</td>
      <td>gamma</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>b</td>
      <td>gamma</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>a</td>
      <td>gamma</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What was a column name has become an index name (<code class="docutils literal notranslate"><span class="pre">col0</span></code>, which you can change with <code class="docutils literal notranslate"><span class="pre">df.index.name='newname'</span></code>) and, when we do add one, it isn’t applied to the index values (here, all zeros). Even though their datatype is <code class="docutils literal notranslate"><span class="pre">int</span></code>, for integer, the index entries are now acting as a label for each row—not as values in the dataframe.</p>
<p>An index can be useful for keeping track of what’s going on, and it’s particularly convenient for some datetime operations.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Working with the dataframe above add the phrase ” more text” onto the two string columns, <code class="docutils literal notranslate"><span class="pre">col3</span></code> and <code class="docutils literal notranslate"><span class="pre">col4</span></code>. Remember that strings respect the <code class="docutils literal notranslate"><span class="pre">+</span></code> operator.</p>
</div>
<p>Whenever you use <code class="docutils literal notranslate"><span class="pre">groupby</span></code> (and some other operations), the columns you use to perform the operation are set as the index of the returned dataframe (you can have multiple index columns). To get back those back to being columns, use the <code class="docutils literal notranslate"><span class="pre">reset_index()</span></code> method like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;col3&quot;</span><span class="p">,</span> <span class="s2">&quot;col4&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>col1</th>
      <th>col2</th>
    </tr>
    <tr>
      <th>col3</th>
      <th>col4</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">a</th>
      <th>alpha</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>gamma</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>b</th>
      <th>gamma</th>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;col3&quot;</span><span class="p">,</span> <span class="s2">&quot;col4&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col3</th>
      <th>col4</th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>alpha</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>a</td>
      <td>gamma</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>b</td>
      <td>gamma</td>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Group the <code class="docutils literal notranslate"><span class="pre">df</span></code> object above by <code class="docutils literal notranslate"><span class="pre">col1</span></code> and <code class="docutils literal notranslate"><span class="pre">col2</span></code> using the <code class="docutils literal notranslate"><span class="pre">first</span></code> aggregation operation in place of <code class="docutils literal notranslate"><span class="pre">sum</span></code> above. Reset the index to return <code class="docutils literal notranslate"><span class="pre">col1</span></code> and <code class="docutils literal notranslate"><span class="pre">col2</span></code> to being regular columns.</p>
</div>
</div>
</div>
<div class="section" id="datatypes">
<h2>Datatypes<a class="headerlink" href="#datatypes" title="Permalink to this headline">¶</a></h2>
<p>Pandas has some built-in datatypes (some are the basic Python datatypes) that will make your life a <em>lot</em> easier if you work with them. Why bother specifying datatypes? Languages like Python let you get away with having pretty much anything in your columns. But this can be a problem: sometimes you’ll end up mixing integers, strings, the generic ‘object’ datatype, and more by mistake. By ensuring that columns conform to a datatype, you can save yourself from some of the trials that come with these mixed datatypes. Some of the most important datatypes for dataframe are string, float, categorical, datetime, int, and boolean.</p>
<p>Typically, you’ll read in a dataset where the dataypes of the columns are a mess. One of the first things you’ll want to do is sort these out. Here’s an example dataset showing how to set the datatypes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;string1&quot;</span><span class="p">,</span> <span class="s2">&quot;string2&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;type_a&quot;</span><span class="p">,</span> <span class="s2">&quot;type_b&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;01-01-1999&quot;</span><span class="p">,</span> <span class="s2">&quot;01-01-2000&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;string_col&quot;</span><span class="p">,</span>
    <span class="s2">&quot;double_col&quot;</span><span class="p">,</span>
    <span class="s2">&quot;category_col&quot;</span><span class="p">,</span>
    <span class="s2">&quot;datetime_col&quot;</span><span class="p">,</span>
    <span class="s2">&quot;integer_col&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bool_col&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2 entries, 0 to 1
Data columns (total 6 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   string_col    2 non-null      object
 1   double_col    2 non-null      object
 2   category_col  2 non-null      object
 3   datetime_col  2 non-null      object
 4   integer_col   2 non-null      object
 5   bool_col      2 non-null      object
dtypes: object(6)
memory usage: 224.0+ bytes
</pre></div>
</div>
</div>
</div>
<p>Note that the data type for all of these columns is the generic ‘Object’ (you can see this from the <code class="docutils literal notranslate"><span class="pre">Dtype</span></code> column that is printed when you use <code class="docutils literal notranslate"><span class="pre">df.info()</span></code>). Let’s fix that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">string_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;string_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">),</span>
    <span class="n">double_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;double_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;double&quot;</span><span class="p">),</span>
    <span class="n">category_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;category_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">),</span>
    <span class="n">datetime_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;datetime_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">),</span>
    <span class="n">integer_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;integer_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">),</span>
    <span class="n">bool_col</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;bool_col&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2 entries, 0 to 1
Data columns (total 6 columns):
 #   Column        Non-Null Count  Dtype         
---  ------        --------------  -----         
 0   string_col    2 non-null      string        
 1   double_col    2 non-null      float64       
 2   category_col  2 non-null      category      
 3   datetime_col  2 non-null      datetime64[ns]
 4   integer_col   2 non-null      int64         
 5   bool_col      2 non-null      bool          
dtypes: bool(1), category(1), datetime64[ns](1), float64(1), int64(1), string(1)
memory usage: 320.0 bytes
</pre></div>
</div>
</div>
</div>
<p>Once you have applied datatypes to the columns in your dataframe, tools like <a class="reference external" href="https://github.com/aeturrell/skimpy">skimpy</a> (install using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">skimpy</span></code> on the command line or <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">skimpy</span></code> within a Colab code cell if you’re using Google Colab) can then provide richer summaries of your data. (Skimpy will try and infer column data types, but it’s not perfect.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skimpy</span> <span class="kn">import</span> <span class="n">skim</span>

<span class="n">skim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">╭───────────────────────────────────── skimpy summary ──────────────────────────────────────╮
│ <span style="font-style: italic">         Data Summary         </span> <span style="font-style: italic">      Data Types       </span> <span style="font-style: italic">       Categories        </span>          │
│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓ ┏━━━━━━━━━━━━━━━━━━━━━━━┓          │
│ ┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> dataframe         </span>┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Values </span>┃ ┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Column Type </span>┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Count </span>┃ ┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Categorical Variables </span>┃          │
│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩ ┡━━━━━━━━━━━━━━━━━━━━━━━┩          │
│ │ Number of rows    │ 2      │ │ string      │ 1     │ │ category_col          │          │
│ │ Number of columns │ 6      │ │ float64     │ 1     │ └───────────────────────┘          │
│ └───────────────────┴────────┘ │ category    │ 1     │                                    │
│                                │ datetime64  │ 1     │                                    │
│                                │ int64       │ 1     │                                    │
│                                │ bool        │ 1     │                                    │
│                                └─────────────┴───────┘                                    │
│ <span style="font-style: italic">                                         number                                         </span>  │
│ ┏━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━┳━━━━━┳━━━━━┳━━━━━┳━━━━━━┳━━━━━━━━┓  │
│ ┃<span style="font-weight: bold">             </span>┃<span style="font-weight: bold"> missing </span>┃<span style="font-weight: bold"> complete     </span>┃<span style="font-weight: bold"> mean </span>┃<span style="font-weight: bold"> sd   </span>┃<span style="font-weight: bold"> p0  </span>┃<span style="font-weight: bold"> p25 </span>┃<span style="font-weight: bold"> p75 </span>┃<span style="font-weight: bold"> p100 </span>┃<span style="font-weight: bold"> hist   </span>┃  │
│ ┃             ┃         ┃<span style="font-weight: bold"> rate         </span>┃      ┃      ┃     ┃     ┃     ┃      ┃        ┃  │
│ ┡━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━╇━━━━━╇━━━━━╇━━━━━╇━━━━━━╇━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">double_col </span> │ <span style="color: #008080; text-decoration-color: #008080">0.0    </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0         </span> │ <span style="color: #008080; text-decoration-color: #008080">2.3 </span> │ <span style="color: #008080; text-decoration-color: #008080">1.6 </span> │ <span style="color: #008080; text-decoration-color: #008080">1.2</span> │ <span style="color: #008080; text-decoration-color: #008080">1.8</span> │ <span style="color: #008080; text-decoration-color: #008080">2.8</span> │ <span style="color: #008080; text-decoration-color: #008080">3.4 </span> │ <span style="color: #008000; text-decoration-color: #008000">█    █</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">integer_col</span> │ <span style="color: #008080; text-decoration-color: #008080">0.0    </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0         </span> │ <span style="color: #008080; text-decoration-color: #008080">1.5 </span> │ <span style="color: #008080; text-decoration-color: #008080">0.71</span> │ <span style="color: #008080; text-decoration-color: #008080">1.0</span> │ <span style="color: #008080; text-decoration-color: #008080">1.2</span> │ <span style="color: #008080; text-decoration-color: #008080">1.8</span> │ <span style="color: #008080; text-decoration-color: #008080">2.0 </span> │ <span style="color: #008000; text-decoration-color: #008000">█    █</span> │  │
│ └─────────────┴─────────┴──────────────┴──────┴──────┴─────┴─────┴─────┴──────┴────────┘  │
│ <span style="font-style: italic">                                        category                                        </span>  │
│ ┏━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┳━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold">                     </span>┃<span style="font-weight: bold"> missing      </span>┃<span style="font-weight: bold"> complete rate         </span>┃<span style="font-weight: bold"> ordered     </span>┃<span style="font-weight: bold"> unique    </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━╇━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">category_col       </span> │ <span style="color: #008080; text-decoration-color: #008080">0.0         </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0                  </span> │ <span style="color: #00d7ff; text-decoration-color: #00d7ff">False      </span> │ <span style="color: #008080; text-decoration-color: #008080">2.0      </span> │  │
│ └─────────────────────┴──────────────┴───────────────────────┴─────────────┴───────────┘  │
│ <span style="font-style: italic">                                        datetime                                        </span>  │
│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold">                   </span>┃<span style="font-weight: bold"> missing    </span>┃<span style="font-weight: bold"> complete rate      </span>┃<span style="font-weight: bold"> first          </span>┃<span style="font-weight: bold"> last          </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">datetime_col     </span> │ <span style="color: #008080; text-decoration-color: #008080">0.0       </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0               </span> │ <span style="color: #800000; text-decoration-color: #800000">1999-01-01    </span> │ <span style="color: #800000; text-decoration-color: #800000">2000-01-01   </span> │  │
│ └───────────────────┴────────────┴────────────────────┴────────────────┴───────────────┘  │
│ <span style="font-style: italic">                                         string                                         </span>  │
│ ┏━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold">                </span>┃<span style="font-weight: bold"> missing    </span>┃<span style="font-weight: bold"> complete rate     </span>┃<span style="font-weight: bold"> words per row     </span>┃<span style="font-weight: bold"> total words    </span>┃  │
│ ┡━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">string_col    </span> │ <span style="color: #008080; text-decoration-color: #008080">0.0       </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0              </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0              </span> │ <span style="color: #008080; text-decoration-color: #008080">2.0           </span> │  │
│ └────────────────┴────────────┴───────────────────┴───────────────────┴────────────────┘  │
│ <span style="font-style: italic">                                          bool                                          </span>  │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold">                        </span>┃<span style="font-weight: bold"> true          </span>┃<span style="font-weight: bold"> true rate                </span>┃<span style="font-weight: bold"> hist             </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">bool_col              </span> │ <span style="color: #008080; text-decoration-color: #008080">2.0          </span> │ <span style="color: #008080; text-decoration-color: #008080">1.0                     </span> │ <span style="color: #008000; text-decoration-color: #008000">   █            </span> │  │
│ └────────────────────────┴───────────────┴──────────────────────────┴──────────────────┘  │
╰─────────────────────────────────────────── End ───────────────────────────────────────────╯
</pre>
</div></div>
</div>
<p>There’s a lot more on exploratory data analysis in the Chapter on <a class="reference internal" href="data-exploratory-analysis.html#data-exploratory-analysis"><span class="std std-ref">Exploratory Data Analysis</span></a>.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Apply the relevant types to this dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;col0&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;col3&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">],</span>
        <span class="s2">&quot;col4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
    <span class="p">},</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;row&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you’re creating a series or dataframe from scratch, here’s how to start off with these datatypes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">str_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;string1&quot;</span><span class="p">,</span> <span class="s2">&quot;string2&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">float_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">cat_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;type_a&quot;</span><span class="p">,</span> <span class="s2">&quot;type_b&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">date_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;01-01-1999&quot;</span><span class="p">,</span> <span class="s2">&quot;01-01-2000&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[ns]&quot;</span><span class="p">)</span>
<span class="n">int_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>
<span class="n">bool_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">str_s</span><span class="p">,</span> <span class="n">float_s</span><span class="p">,</span> <span class="n">cat_s</span><span class="p">,</span> <span class="n">date_s</span><span class="p">,</span> <span class="n">int_s</span><span class="p">,</span> <span class="n">bool_s</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2 entries, 0 to 1
Data columns (total 6 columns):
 #   Column  Non-Null Count  Dtype         
---  ------  --------------  -----         
 0   0       2 non-null      string        
 1   1       2 non-null      float64       
 2   2       2 non-null      category      
 3   3       2 non-null      datetime64[ns]
 4   4       2 non-null      int64         
 5   5       2 non-null      bool          
dtypes: bool(1), category(1), datetime64[ns](1), float64(1), int64(1), string(1)
memory usage: 320.0 bytes
</pre></div>
</div>
</div>
</div>
<div class="section" id="categorical-variables">
<h3>Categorical variables<a class="headerlink" href="#categorical-variables" title="Permalink to this headline">¶</a></h3>
<p>Categorical variables can be especially useful. They imply a finite set of possible values, for example, different UK counties. They have datatype <code class="docutils literal notranslate"><span class="pre">&quot;category&quot;</span></code> as shown above but can be created from elements that have whatever datatype you like (eg, also above, the “type_a” and “type_b” values have datatype string before being cast as “category”). In the context of regression, you might call these “fixed effects” variables.</p>
<p>As well as using <code class="docutils literal notranslate"><span class="pre">.astype(&quot;category&quot;)</span></code> on a column to convert it directly to be of categorical type, there are a couple of convenience functions that allow you to create them from other types of columns. <code class="docutils literal notranslate"><span class="pre">pd.cut</span></code> splits input data into a given number of (evenly spaced) bins that you can (optionally) give names to via the <code class="docutils literal notranslate"><span class="pre">labels=</span></code> keyword. The default behaviour is for the order of the labels to matter so that, in the below example, the bins will be evenly spaced from the smallest value to the largest, with the smallest receiving the label <code class="docutils literal notranslate"><span class="pre">bad</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bad&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;good&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;bad&#39;, &#39;good&#39;, &#39;medium&#39;, &#39;medium&#39;, &#39;good&#39;, &#39;bad&#39;]
Categories (3, object): [&#39;bad&#39; &lt; &#39;medium&#39; &lt; &#39;good&#39;]
</pre></div>
</div>
</div>
</div>
<p>We can also pass the bins directly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0, 5], (5, 10], (0, 5], (0, 5], (5, 10], (0, 5]]
Categories (3, interval[int64, right]): [(-5, 0] &lt; (0, 5] &lt; (5, 10]]
</pre></div>
</div>
</div>
</div>
<p>Another useful function is qcut, which provides a categorical breakdown according to a given number of quantiles (eg 4 produces quartiles):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.999, 3.0], (0.999, 3.0], (0.999, 3.0], (3.0, 5.0], (3.0, 5.0], (5.0, 7.0], (5.0, 7.0], (7.0, 9.0], (7.0, 9.0]]
Categories (4, interval[float64, right]): [(0.999, 3.0] &lt; (3.0, 5.0] &lt; (5.0, 7.0] &lt; (7.0, 9.0]]
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Apply the 5-point Likert scale (Strongly disagree, Disagree, Neither Agree nor Disagree, Agree, Strongly Disagree) to the data generated by <code class="docutils literal notranslate"><span class="pre">prng.standard_normal(size=100)</span></code> using <code class="docutils literal notranslate"><span class="pre">pd.qcut</span></code> with the keyword argument <code class="docutils literal notranslate"><span class="pre">retbins=True</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="accessing-and-slicing">
<h2>Accessing and slicing<a class="headerlink" href="#accessing-and-slicing" title="Permalink to this headline">¶</a></h2>
<p>Now you know how to put data in a dataframe, how do you access the bits of it you need? There are various ways. If you want to access an entire column, the syntax is very simple; <code class="docutils literal notranslate"><span class="pre">df['columname']</span></code> (you can also use <code class="docutils literal notranslate"><span class="pre">df.columname</span></code>).</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/03_subset_columns.svg" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a     1.0
b     7.0
c    13.0
d    19.0
e    25.0
f    31.0
Name: col1, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Accessing multiple columns can be achieved with a list of the columns you’d like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;col1&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>7.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>13.0</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>19.0</td>
      <td>20.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>25.0</td>
      <td>26.0</td>
    </tr>
    <tr>
      <th>f</th>
      <td>31.0</td>
      <td>32.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Access columns 2 and 3 using the named-access syntax above.</p>
</div>
<p>To access a particular row, it’s <code class="docutils literal notranslate"><span class="pre">df.loc['rowname']</span></code> or <code class="docutils literal notranslate"><span class="pre">df.loc[['rowname1',</span> <span class="pre">'rowname1']]</span></code> for two different rows.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/03_subset_rows.svg" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col0</th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
      <th>col5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>6.0</td>
      <td>7.0</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>11.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Access rows c and f using the named-access syntax above.</p>
</div>
<p>As well as the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> method, there is the <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> method that accesses rows or columns based on their position, for example <code class="docutils literal notranslate"><span class="pre">df.iloc[i,</span> <span class="pre">:]</span></code> for the ith row and <code class="docutils literal notranslate"><span class="pre">df.iloc[:,</span> <span class="pre">j]</span></code> for the jth column (but remember that indexing starts from zero).</p>
<p>To access an individual value from within the dataframe, we have two options: pass an index value and a column name to <code class="docutils literal notranslate"><span class="pre">.loc[rowname,</span> <span class="pre">columnname]</span></code> or retrieve the value by using its position using <code class="docutils literal notranslate"><span class="pre">.iloc[row,</span> <span class="pre">column]</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using .loc</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;col2&quot;</span><span class="p">])</span>
<span class="c1"># Using .iloc</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.0
8.0
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Indexing from zero, access the row 0 and column 1 entries using the position based-access syntax above.</p>
</div>
<p>With all of these different ways to access values in dataframes, it can get confusing. These are the different ways to get the first column of a dataframe (when that first column is called <code class="docutils literal notranslate"><span class="pre">column</span></code> and the dataframe is <code class="docutils literal notranslate"><span class="pre">df</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.column</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df[&quot;column&quot;]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[:,</span> <span class="pre">&quot;column&quot;]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.iloc[:,</span> <span class="pre">0]</span></code></p></li>
</ul>
<p>Note that <code class="docutils literal notranslate"><span class="pre">:</span></code> means ‘give me everything’! The ways to access rows are similar (here assuming the first row is called <code class="docutils literal notranslate"><span class="pre">row</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[&quot;row&quot;,</span> <span class="pre">:]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.iloc[0,</span> <span class="pre">:]</span></code></p></li>
</ul>
<p>And to access the first value (ie the value in first row, first column):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df.column[0]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df[&quot;column&quot;][0]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.iloc[0,</span> <span class="pre">0]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df.loc[&quot;row&quot;,</span> <span class="pre">&quot;column&quot;]</span></code></p></li>
</ul>
<p>In the above examples, square brackets are instructions about <em>where</em> to grab bits from the dataframe. They are a bit like an address system for values within a dataframe. Square brackets <em>also</em> denote lists though. So if you want to select <em>multiple</em> columns or rows, you might see syntax like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">df.loc[[&quot;row0&quot;,</span> <span class="pre">&quot;row1&quot;],</span> <span class="pre">[&quot;column0&quot;,</span> <span class="pre">&quot;column2&quot;]]</span></code></p>
<p>which picks out two rows and two columns via the lists <code class="docutils literal notranslate"><span class="pre">[&quot;row0&quot;,</span> <span class="pre">&quot;row1&quot;]</span></code> and <code class="docutils literal notranslate"><span class="pre">[&quot;column0&quot;,</span> <span class="pre">&quot;column2&quot;]</span></code>. Because there are lists alongside the usual system of selecting values, there are two sets of square brackets.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>If you only want to remember one syntax for accessing rows and columns by name, use the pattern <code class="docutils literal notranslate"><span class="pre">df.loc[[&quot;row0&quot;,</span> <span class="pre">&quot;row1&quot;,</span> <span class="pre">...],</span> <span class="pre">[&quot;col0&quot;,</span> <span class="pre">&quot;col1&quot;,</span> <span class="pre">...]]</span></code>. This also works with a single row or a single column (or both).</p>
<p>If you only want to remember one syntax for accessing rows and columns by position, use the pattern <code class="docutils literal notranslate"><span class="pre">df.iloc[[0,</span> <span class="pre">1,</span> <span class="pre">...],</span> <span class="pre">[0,</span> <span class="pre">1,</span> <span class="pre">...]]</span></code>. This also works with a single row or a single column (or both).</p>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Access columns 2 and 3, and rows a and c, using the <code class="docutils literal notranslate"><span class="pre">df.loc</span></code> syntax with lists for the columns and rows.</p>
<p>Access columns 2 and 3, and rows a and c, using the <code class="docutils literal notranslate"><span class="pre">df.iloc</span></code> syntax with lists for the columns and rows.</p>
</div>
<p>So often, what we really want is a subset of values (as opposed to <em>all</em> values or just <em>one</em> value). This is where <em>slicing</em> comes in. If you’ve looked at the Chapter on <a class="reference internal" href="code-basics.html#code-basics"><span class="std std-ref">Basics of Coding</span></a>, you’ll know a bit about slicing and indexing already, but we’ll cover the basics here too.</p>
<p>The syntax for slicing is similar to what we’ve seen already: there are two methods <code class="docutils literal notranslate"><span class="pre">.loc</span></code> to access items by name, and <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> to access them by position. The syntax for the former is <code class="docutils literal notranslate"><span class="pre">df.loc[start:stop:step,</span> <span class="pre">start:stop:step]</span></code>, where the first position is index name and the second is column name (and the same applies for numbers and <code class="docutils literal notranslate"><span class="pre">df.iloc</span></code>). Let’s see some examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;f&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;col1&quot;</span><span class="p">:</span><span class="s2">&quot;col3&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>13.0</td>
      <td>14.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>25.0</td>
      <td>26.0</td>
      <td>27.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As you can see, slicing even works on names! By asking for rows <code class="docutils literal notranslate"><span class="pre">'a':'f':2</span></code>, we get every other row from ‘a’ to ‘f’ (inclusive). Likewise, for columns, we asked for every column between <code class="docutils literal notranslate"><span class="pre">col1</span></code> and <code class="docutils literal notranslate"><span class="pre">col3</span></code> (inclusive). <code class="docutils literal notranslate"><span class="pre">iloc</span></code> works in a very similar way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col0</th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
      <th>col4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>6.0</td>
      <td>7.0</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>12.0</td>
      <td>13.0</td>
      <td>14.0</td>
      <td>15.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>18.0</td>
      <td>19.0</td>
      <td>20.0</td>
      <td>21.0</td>
      <td>22.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>24.0</td>
      <td>25.0</td>
      <td>26.0</td>
      <td>27.0</td>
      <td>28.0</td>
    </tr>
    <tr>
      <th>f</th>
      <td>30.0</td>
      <td>31.0</td>
      <td>32.0</td>
      <td>33.0</td>
      <td>34.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In this case, we asked for everything from row 1 onwards, and everything up to (but excluding) the last column.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Access every other column between columns 1 and 5, and rows a to c using the <code class="docutils literal notranslate"><span class="pre">.loc</span></code> syntax.</p>
<p>Access the same columns and rows using the <code class="docutils literal notranslate"><span class="pre">.iloc</span></code> syntax.</p>
</div>
<p>It’s not just strings and positions that can be sliced though, here’s an example using <em>dates</em> (<strong>pandas</strong> support for dates is truly excellent):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot;ABCDE&quot;</span><span class="p">))</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>2</td>
      <td>8</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>2</td>
      <td>2</td>
      <td>6</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>2</td>
      <td>6</td>
      <td>1</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>4</td>
      <td>5</td>
      <td>7</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>5</td>
      <td>6</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>3</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>7</td>
      <td>2</td>
      <td>0</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2002-09-30</th>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2002-12-31</th>
      <td>6</td>
      <td>5</td>
      <td>7</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s do some slicing!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">:</span><span class="s2">&quot;2002-01-01&quot;</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>2</td>
      <td>8</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>2</td>
      <td>2</td>
      <td>6</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>2</td>
      <td>6</td>
      <td>1</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>4</td>
      <td>5</td>
      <td>7</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>5</td>
      <td>6</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Two important points to note here: first, <strong>pandas</strong> doesn’t mind that we supplied a date that didn’t actually exist in the index. It worked out that by ‘2000-01-01’ we meant a datetime and compared the values of the index to that datetime in order to decide what rows to return from the dataframe. The second thing to notice is the use of <code class="docutils literal notranslate"><span class="pre">:</span></code> for the column names; this explicitly says ‘give me all the columns’.</p>
</div>
<div class="section" id="operations-on-dataframes">
<h2>Operations on dataframes<a class="headerlink" href="#operations-on-dataframes" title="Permalink to this headline">¶</a></h2>
<p>Columns in dataframes can undergo all the usual arithmetic operations you’d expect of addition, multiplication, division, and so on. If the underlying datatypes of two columns have a group operation, then the dataframe columns will use that.</p>
<p><img alt="" src="https://github.com/pandas-dev/pandas/raw/059c8bac51e47d6eaaa3e36d6a293a22312925e6/doc/source/_static/schemas/05_newcolumn_1.svg" /></p>
<p>The results of these manipulations can just be saved as a new series, eg, <code class="docutils literal notranslate"><span class="pre">new_series</span> <span class="pre">=</span> <span class="pre">df['A']</span> <span class="pre">+</span> <span class="pre">df['B']</span></code> or created as a new column of the dataframe:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;new_col&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
      <th>new_col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>2</td>
      <td>8</td>
      <td>1</td>
      <td>4</td>
      <td>6</td>
      <td>129</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>6</td>
      <td>7</td>
      <td>37</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>2</td>
      <td>2</td>
      <td>6</td>
      <td>3</td>
      <td>7</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>2</td>
      <td>6</td>
      <td>1</td>
      <td>3</td>
      <td>6</td>
      <td>73</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>4</td>
      <td>5</td>
      <td>7</td>
      <td>2</td>
      <td>2</td>
      <td>101</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>1</td>
      <td>6</td>
      <td>181</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>5</td>
      <td>6</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>181</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>3</td>
      <td>9</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>7</td>
      <td>2</td>
      <td>0</td>
      <td>5</td>
      <td>2</td>
      <td>29</td>
    </tr>
    <tr>
      <th>2002-09-30</th>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>2</td>
      <td>5</td>
      <td>17</td>
    </tr>
    <tr>
      <th>2002-12-31</th>
      <td>6</td>
      <td>5</td>
      <td>7</td>
      <td>0</td>
      <td>2</td>
      <td>151</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Boolean variables and strings have group operations (eg concatenation is via <code class="docutils literal notranslate"><span class="pre">+</span></code> with strings), and so work well with column operations too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]},</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> a and c:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> b or d:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       a      b      c      d
0   True  False  False   True
1  False   True   True   True
2   True   True   True  False

 a and c:

0    False
1    False
2     True
dtype: bool

 b or d:

0    True
1    True
2    True
dtype: bool
</pre></div>
</div>
</div>
</div>
<p>More complex operations on whole dataframes are supported, but if you’re doing very heavy lifting you might want to just switch to using numpy arrays (<strong>numpy</strong> provides fast numerical, vector, matrix, and tensor operations in Python; it has some similarities with the functionality of Matlab). As examples though, you can transpose and exponentiate easily:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot;ABCDE&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Dataframe:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Exponentiation:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Transpose:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Dataframe:
   A  B  C  D  E
0  4  3  2  3  4
1  4  3  4  0  4
2  0  4  3  3  4

 Exponentiation:
          A          B          C          D         E
0  54.59815  20.085537   7.389056  20.085537  54.59815
1  54.59815  20.085537  54.598150   1.000000  54.59815
2   1.00000  54.598150  20.085537  20.085537  54.59815

 Transpose:
   0  1  2
A  4  4  0
B  3  3  4
C  2  4  3
D  3  0  3
E  4  4  4
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="aggregation">
<h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h2>
<p><strong>pandas</strong> has built-in aggregation functions such as</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Aggregation</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">count()</span></code></p></td>
<td><p>Number of items</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">first()</span></code>, <code class="docutils literal notranslate"><span class="pre">last()</span></code></p></td>
<td><p>First and last item</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mean()</span></code>, <code class="docutils literal notranslate"><span class="pre">median()</span></code></p></td>
<td><p>Mean and median</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code></p></td>
<td><p>Minimum and maximum</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">std()</span></code>, <code class="docutils literal notranslate"><span class="pre">var()</span></code></p></td>
<td><p>Standard deviation and variance</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mad()</span></code></p></td>
<td><p>Mean absolute deviation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prod()</span></code></p></td>
<td><p>Product of all items</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code></p></td>
<td><p>Sum of all items</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">value_counts()</span></code></p></td>
<td><p>Counts of unique values</p></td>
</tr>
</tbody>
</table>
<p>these can applied to all entries in a dataframe, or optionally to rows or columns using <code class="docutils literal notranslate"><span class="pre">axis=0</span></code> or <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A     8
B    10
C     9
D     6
E    12
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Find the mean values of each column (eg leaving only column headers so aggregating over rows using <code class="docutils literal notranslate"><span class="pre">axis=0</span></code>) and the mean values of each row (eg leaving only row headers and therefore aggregating over columns using <code class="docutils literal notranslate"><span class="pre">axis=1</span></code>)</p>
</div>
</div>
<div class="section" id="split-apply-and-combine">
<h2>Split, apply, and combine<a class="headerlink" href="#split-apply-and-combine" title="Permalink to this headline">¶</a></h2>
<p>Splitting a dataset, applying a function, and combining the results are three key operations that we’ll want to use again and again. Splitting means differentiating between rows or columns of data based on some conditions, for instance different categories or different values. Applying means applying a function, for example finding the mean or sum. Combine means putting the results of these operations back into the dataframe, or into a variable. The figure gives an example</p>
<p><img alt="" src="https://jakevdp.github.io/PythonDataScienceHandbook/figures/03.08-split-apply-combine.png" /></p>
<p>Note that the ‘combine’ part doesn’t always have to result in a new dataframe; it could create new columns in an existing dataframe.</p>
<p>Let’s first see a really simple example of splitting a dataset into groups and finding the mean across those groups using the <em>penguins</em> dataset. We’ll group the data by island and look at the means.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;penguins&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;island&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
    </tr>
    <tr>
      <th>island</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Biscoe</th>
      <td>45.257485</td>
      <td>15.874850</td>
      <td>209.706587</td>
      <td>4716.017964</td>
    </tr>
    <tr>
      <th>Dream</th>
      <td>44.167742</td>
      <td>18.344355</td>
      <td>193.072581</td>
      <td>3712.903226</td>
    </tr>
    <tr>
      <th>Torgersen</th>
      <td>38.950980</td>
      <td>18.429412</td>
      <td>191.196078</td>
      <td>3706.372549</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The aggregations from the previous part all work on grouped data. An example is <code class="docutils literal notranslate"><span class="pre">df['body_mass_g'].groupby('island').std()</span></code> for the standard deviation of body mass by island.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Using a groupby, find the standard deviation of different penguin species’ body measurements. (Hint: standard deviation has its own aggregation/combine function given by <code class="docutils literal notranslate"><span class="pre">std()</span></code>)</p>
</div>
<p>You can also pass other functions via the <code class="docutils literal notranslate"><span class="pre">agg</span></code> method (short for aggregation). Here we pass two numpy functions (these two functions have built-in equivalents <code class="docutils literal notranslate"><span class="pre">std()</span></code> and <code class="docutils literal notranslate"><span class="pre">mean()</span></code> so this is just for illustrative purposes):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;species&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">bill_length_mm</th>
      <th colspan="2" halign="left">bill_depth_mm</th>
      <th colspan="2" halign="left">flipper_length_mm</th>
      <th colspan="2" halign="left">body_mass_g</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
    </tr>
    <tr>
      <th>species</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Adelie</th>
      <td>38.791391</td>
      <td>2.663405</td>
      <td>18.346358</td>
      <td>1.216650</td>
      <td>189.953642</td>
      <td>6.539457</td>
      <td>3700.662252</td>
      <td>458.566126</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <td>48.833824</td>
      <td>3.339256</td>
      <td>18.420588</td>
      <td>1.135395</td>
      <td>195.823529</td>
      <td>7.131894</td>
      <td>3733.088235</td>
      <td>384.335081</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <td>47.504878</td>
      <td>3.081857</td>
      <td>14.982114</td>
      <td>0.981220</td>
      <td>217.186992</td>
      <td>6.484976</td>
      <td>5076.016260</td>
      <td>504.116237</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">numpy</span></code> functions, find the max and min of all columns grouping by <code class="docutils literal notranslate"><span class="pre">island</span></code>.</p>
</div>
<p>Multiple aggregations can also be performed at once on the entire dataframe by using a dictionary to map columns into functions. You can also group by as many variables as you like by passing the groupby method a list of variables. Here’s an example that combines both of these features:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="s2">&quot;island&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;body_mass_g&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;bill_length_mm&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>body_mass_g</th>
      <th>bill_length_mm</th>
    </tr>
    <tr>
      <th>species</th>
      <th>island</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">Adelie</th>
      <th>Biscoe</th>
      <td>163225.0</td>
      <td>38.975000</td>
    </tr>
    <tr>
      <th>Dream</th>
      <td>206550.0</td>
      <td>38.501786</td>
    </tr>
    <tr>
      <th>Torgersen</th>
      <td>189025.0</td>
      <td>38.950980</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <th>Dream</th>
      <td>253850.0</td>
      <td>48.833824</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <th>Biscoe</th>
      <td>624350.0</td>
      <td>47.504878</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Using a two-column <code class="docutils literal notranslate"><span class="pre">groupby</span></code> on species and island and an <code class="docutils literal notranslate"><span class="pre">agg</span></code>, use a dictionary to find the min of <code class="docutils literal notranslate"><span class="pre">bill_depth_mm</span></code> and the max of <code class="docutils literal notranslate"><span class="pre">flipper_length_mm</span></code></p>
</div>
<p>Sometimes, inheriting the column names becomes problematic. There’s a slightly fussy syntax to help with that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;species&quot;</span><span class="p">,</span> <span class="s2">&quot;island&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="n">count_bill</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">),</span>
    <span class="n">mean_bill</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
    <span class="n">std_flipper</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;flipper_length_mm&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>count_bill</th>
      <th>mean_bill</th>
      <th>std_flipper</th>
    </tr>
    <tr>
      <th>species</th>
      <th>island</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">Adelie</th>
      <th>Biscoe</th>
      <td>44</td>
      <td>38.975000</td>
      <td>6.729247</td>
    </tr>
    <tr>
      <th>Dream</th>
      <td>56</td>
      <td>38.501786</td>
      <td>6.585083</td>
    </tr>
    <tr>
      <th>Torgersen</th>
      <td>51</td>
      <td>38.950980</td>
      <td>6.232238</td>
    </tr>
    <tr>
      <th>Chinstrap</th>
      <th>Dream</th>
      <td>68</td>
      <td>48.833824</td>
      <td>7.131894</td>
    </tr>
    <tr>
      <th>Gentoo</th>
      <th>Biscoe</th>
      <td>123</td>
      <td>47.504878</td>
      <td>6.484976</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Using a two-column <code class="docutils literal notranslate"><span class="pre">groupby</span></code> on species and island and a named <code class="docutils literal notranslate"><span class="pre">agg</span></code>, create a new column called <code class="docutils literal notranslate"><span class="pre">mean_flipper</span></code> that gives the mean of <code class="docutils literal notranslate"><span class="pre">flipper_length_mm</span></code>.</p>
</div>
<p>Finally, you should know about the <code class="docutils literal notranslate"><span class="pre">apply</span></code> method, which takes a function and applies it to a given axis (<code class="docutils literal notranslate"><span class="pre">axis=0</span></code> for index, <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> for columns) or column. The simple example below shows how it works, though in practice you’d just use <code class="docutils literal notranslate"><span class="pre">df['body_mass_kg']</span> <span class="pre">=</span> <span class="pre">df['body_mass_g]/1e3</span></code> to do this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">g_to_kg</span><span class="p">(</span><span class="n">mass_in_g</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mass_in_g</span> <span class="o">/</span> <span class="mf">1e3</span>


<span class="n">df</span><span class="p">[</span><span class="s2">&quot;mass_in_kg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;body_mass_g&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">g_to_kg</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
      <th>mass_in_kg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
      <td>3.75</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
      <td>3.80</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
      <td>3.25</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
      <td>3.45</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Write a function that converts flipper length into metres and use it to create a new column with a sensible name.</p>
</div>
</div>
<div class="section" id="filter-transform-apply-and-assign">
<h2>Filter, transform, apply, and assign<a class="headerlink" href="#filter-transform-apply-and-assign" title="Permalink to this headline">¶</a></h2>
<div class="section" id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h3>
<p>Filtering does exactly what it sounds like, but it can make use of group-by commands. In the example below, all but one species is filtered out.</p>
<p>In the example below, <code class="docutils literal notranslate"><span class="pre">filter</span></code> passes a grouped version of the dataframe into the <code class="docutils literal notranslate"><span class="pre">filter_func</span></code> we’ve defined (imagine that a dataframe is passed for each group). Because the passed variable is a dataframe, and variable <code class="docutils literal notranslate"><span class="pre">x</span></code> is defined in the function, the <code class="docutils literal notranslate"><span class="pre">x</span></code> within <code class="docutils literal notranslate"><span class="pre">filter_func</span></code> body behaves like our dataframe–including having the same columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filter_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">48</span>


<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;species&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filter_func</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
      <th>mass_in_kg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>152</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>46.5</td>
      <td>17.9</td>
      <td>192.0</td>
      <td>3500.0</td>
      <td>Female</td>
      <td>3.500</td>
    </tr>
    <tr>
      <th>153</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>50.0</td>
      <td>19.5</td>
      <td>196.0</td>
      <td>3900.0</td>
      <td>Male</td>
      <td>3.900</td>
    </tr>
    <tr>
      <th>154</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>51.3</td>
      <td>19.2</td>
      <td>193.0</td>
      <td>3650.0</td>
      <td>Male</td>
      <td>3.650</td>
    </tr>
    <tr>
      <th>155</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>45.4</td>
      <td>18.7</td>
      <td>188.0</td>
      <td>3525.0</td>
      <td>Female</td>
      <td>3.525</td>
    </tr>
    <tr>
      <th>156</th>
      <td>Chinstrap</td>
      <td>Dream</td>
      <td>52.7</td>
      <td>19.8</td>
      <td>197.0</td>
      <td>3725.0</td>
      <td>Male</td>
      <td>3.725</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="transform">
<h3>Transform<a class="headerlink" href="#transform" title="Permalink to this headline">¶</a></h3>
<p>Transforms return a transformed version of the data, typically with an intermediate groupby, that has the same shape as the input. Think of it as split-apply-combine but without the ‘combine’ part! This is useful when creating new columns that depend on some grouped data, for instance creating group-wise means. Here’s an example using the datetime group to subtract a yearly mean. First let’s create some synthetic data with some data, a datetime index, and some groups:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;values1&quot;</span><span class="p">,</span> <span class="s2">&quot;values2&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;group&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values1</th>
      <th>values2</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>7</td>
      <td>3</td>
      <td>group2</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>4</td>
      <td>4</td>
      <td>group0</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>5</td>
      <td>3</td>
      <td>group1</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>6</td>
      <td>2</td>
      <td>group2</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>0</td>
      <td>4</td>
      <td>group2</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>9</td>
      <td>6</td>
      <td>group2</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>7</td>
      <td>7</td>
      <td>group0</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>1</td>
      <td>4</td>
      <td>group1</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>1</td>
      <td>2</td>
      <td>group2</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>9</td>
      <td>5</td>
      <td>group1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we take the yearly means by type. <code class="docutils literal notranslate"><span class="pre">pd.Grouper(freq='A')</span></code> is an instruction to take the <code class="docutils literal notranslate"><span class="pre">A</span></code>nnual mean using the given datetime index. You can group on as many coloumns and/or index properties as you like: this example groups by a property of the datetime index and on the <code class="docutils literal notranslate"><span class="pre">type</span></code> column, but performs the computation on the <code class="docutils literal notranslate"><span class="pre">values1</span></code> column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;v1_demean_yr_and_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="s2">&quot;type&quot;</span><span class="p">])[</span>
    <span class="s2">&quot;values1&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values1</th>
      <th>values2</th>
      <th>type</th>
      <th>v1_demean_yr_and_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>7</td>
      <td>3</td>
      <td>group2</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>4</td>
      <td>4</td>
      <td>group0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>5</td>
      <td>3</td>
      <td>group1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>6</td>
      <td>2</td>
      <td>group2</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>0</td>
      <td>4</td>
      <td>group2</td>
      <td>-4.5</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>9</td>
      <td>6</td>
      <td>group2</td>
      <td>4.5</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>7</td>
      <td>7</td>
      <td>group0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>1</td>
      <td>4</td>
      <td>group1</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>1</td>
      <td>2</td>
      <td>group2</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>9</td>
      <td>5</td>
      <td>group1</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Create a new column that gives <code class="docutils literal notranslate"><span class="pre">values2</span></code> normalised (minus the mean and divided by standard deviation) by <code class="docutils literal notranslate"><span class="pre">type</span></code>.</p>
</div>
<p>You’ll have seen there’s a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> keyword here. Lambda (or anonymous) functions have a rich history in mathematics, and were used by scientists such as Church and Turing to create proofs about what is computable <em>before electronic computers existed</em>. They can be used to define compact functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multiply_plus_one</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">multiply_plus_one</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="apply">
<h3>Apply<a class="headerlink" href="#apply" title="Permalink to this headline">¶</a></h3>
<p>Both regular functions and lambda functions can be used with the more general apply method, which takes a function and applies it to a given axis (<code class="docutils literal notranslate"><span class="pre">axis=0</span></code> for index, <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> for columns):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;val1_times_val2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;values1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;values2&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values1</th>
      <th>values2</th>
      <th>type</th>
      <th>v1_demean_yr_and_type</th>
      <th>val1_times_val2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>7</td>
      <td>3</td>
      <td>group2</td>
      <td>0.5</td>
      <td>21</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>4</td>
      <td>4</td>
      <td>group0</td>
      <td>0.0</td>
      <td>16</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>5</td>
      <td>3</td>
      <td>group1</td>
      <td>0.0</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>6</td>
      <td>2</td>
      <td>group2</td>
      <td>-0.5</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>0</td>
      <td>4</td>
      <td>group2</td>
      <td>-4.5</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>9</td>
      <td>6</td>
      <td>group2</td>
      <td>4.5</td>
      <td>54</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>7</td>
      <td>7</td>
      <td>group0</td>
      <td>0.0</td>
      <td>49</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>1</td>
      <td>4</td>
      <td>group1</td>
      <td>0.0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>1</td>
      <td>2</td>
      <td>group2</td>
      <td>0.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>9</td>
      <td>5</td>
      <td>group1</td>
      <td>0.0</td>
      <td>45</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Of course, the much easier way to do this very common operation is <code class="docutils literal notranslate"><span class="pre">df['val1_times_val2']</span> <span class="pre">=</span> <span class="pre">df['values1']*df['values2']</span></code>, but there are times when you need to run more complex functions element-wise and, for those, <code class="docutils literal notranslate"><span class="pre">apply</span></code> is really useful.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Write an apply function that raises entries in <code class="docutils literal notranslate"><span class="pre">values1</span></code> to the power of entries in <code class="docutils literal notranslate"><span class="pre">values2</span></code></p>
</div>
</div>
<div class="section" id="assign">
<h3>Assign<a class="headerlink" href="#assign" title="Permalink to this headline">¶</a></h3>
<p>Assign is a method that allows you to return a new object with all the original columns in addition to new ones. Existing columns that are re-assigned will be overwritten. This is <em>really</em> useful when you want to perform a bunch of operations together in a concise way and keep the original columns. For instance, to demean the ‘values1’ column by year-type and to recompute the ‘val1_times_val2’ column using the newly demeaned ‘values1’ column:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
    <span class="n">values1</span><span class="o">=</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">),</span> <span class="s2">&quot;type&quot;</span><span class="p">])[</span><span class="s2">&quot;values1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">val1_times_val2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;values1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;values2&quot;</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values1</th>
      <th>values2</th>
      <th>type</th>
      <th>v1_demean_yr_and_type</th>
      <th>val1_times_val2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-03-31</th>
      <td>0.5</td>
      <td>3</td>
      <td>group2</td>
      <td>0.5</td>
      <td>1.5</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>0.0</td>
      <td>4</td>
      <td>group0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>0.0</td>
      <td>3</td>
      <td>group1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>-0.5</td>
      <td>2</td>
      <td>group2</td>
      <td>-0.5</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>2001-03-31</th>
      <td>-4.5</td>
      <td>4</td>
      <td>group2</td>
      <td>-4.5</td>
      <td>-18.0</td>
    </tr>
    <tr>
      <th>2001-06-30</th>
      <td>4.5</td>
      <td>6</td>
      <td>group2</td>
      <td>4.5</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>2001-09-30</th>
      <td>0.0</td>
      <td>7</td>
      <td>group0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>0.0</td>
      <td>4</td>
      <td>group1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2002-03-31</th>
      <td>0.0</td>
      <td>2</td>
      <td>group2</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2002-06-30</th>
      <td>0.0</td>
      <td>5</td>
      <td>group1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Re-write the transform function from the transform exercise (creating a normalised column transformed by <code class="docutils literal notranslate"><span class="pre">type</span></code>) as an assign statement with a new column name <code class="docutils literal notranslate"><span class="pre">transformed_by_type</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="query-and-eval">
<h2>Query and Eval<a class="headerlink" href="#query-and-eval" title="Permalink to this headline">¶</a></h2>
<p>Let’s load some data for demonstration purposes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;penguins&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="query">
<h3>Query<a class="headerlink" href="#query" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">query</span></code> allows you to query the columns of a DataFrame with an expression in a string. It’s particularly useful for selecting a lot of rows at once based on a condition. Here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;body_mass_g &gt; 6e3&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>237</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>49.2</td>
      <td>15.2</td>
      <td>221.0</td>
      <td>6300.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>253</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>59.6</td>
      <td>17.0</td>
      <td>230.0</td>
      <td>6050.0</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">query</span></code> can be used to pick out rows based on relationships between columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;bill_length_mm&lt;bill_depth_mm*1.8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>34.6</td>
      <td>21.1</td>
      <td>198.0</td>
      <td>4400.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>33.5</td>
      <td>19.0</td>
      <td>190.0</td>
      <td>3600.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Variables not in dataframes can be referenced with an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character like <code class="docutils literal notranslate"><span class="pre">&#64;a</span> <span class="pre">+</span> <span class="pre">b</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outside_var</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;bill_depth_mm &gt; @outside_var&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>38.6</td>
      <td>21.2</td>
      <td>191.0</td>
      <td>3800.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>34.6</td>
      <td>21.1</td>
      <td>198.0</td>
      <td>4400.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>46.0</td>
      <td>21.5</td>
      <td>194.0</td>
      <td>4200.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Adelie</td>
      <td>Dream</td>
      <td>39.2</td>
      <td>21.1</td>
      <td>196.0</td>
      <td>4150.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Adelie</td>
      <td>Dream</td>
      <td>42.3</td>
      <td>21.2</td>
      <td>191.0</td>
      <td>4150.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Adelie</td>
      <td>Biscoe</td>
      <td>41.3</td>
      <td>21.1</td>
      <td>195.0</td>
      <td>4400.0</td>
      <td>Male</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="eval">
<h3>Eval<a class="headerlink" href="#eval" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">eval</span></code> evaluates a string describing operations on DataFrame columns to create new columns. It operates on columns only, not rows or elements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;bill_length_mm / bill_depth_mm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    2.090909
1    2.270115
2    2.238889
3         NaN
4    1.901554
dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">eval</span></code> is especially useful for filtering by multiple columns at once:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eval_string</span> <span class="o">=</span> <span class="s2">&quot;species == &#39;Gentoo&#39; &amp; island == &#39;Biscoe&#39; &amp; sex == &#39;Female&#39;&quot;</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">eval_string</span><span class="p">),</span> <span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>220</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>46.1</td>
      <td>13.2</td>
      <td>211.0</td>
      <td>4500.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>222</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>48.7</td>
      <td>14.1</td>
      <td>210.0</td>
      <td>4450.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>225</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>46.5</td>
      <td>13.5</td>
      <td>210.0</td>
      <td>4550.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>226</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>45.4</td>
      <td>14.6</td>
      <td>211.0</td>
      <td>4800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>228</th>
      <td>Gentoo</td>
      <td>Biscoe</td>
      <td>43.3</td>
      <td>13.4</td>
      <td>209.0</td>
      <td>4400.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="time-series-resampling-and-rolling-windows">
<h2>Time series, resampling, and rolling windows<a class="headerlink" href="#time-series-resampling-and-rolling-windows" title="Permalink to this headline">¶</a></h2>
<p>The support for time series and the datetime type is excellent in pandas. It is very easy to manipulate datetimes. The <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html">relevant part</a> of the documentation has more info; here we’ll just see a couple of the most important bits. First, let’s create some synthetic data to work with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recursive_ts</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">shock</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">shock</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">recursive_ts</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">shock</span>


<span class="n">t_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="n">recursive_ts</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)])</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">t_series</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;2000-08-31&quot;</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-31</th>
      <td>0.360739</td>
    </tr>
    <tr>
      <th>2000-02-29</th>
      <td>-0.881001</td>
    </tr>
    <tr>
      <th>2000-03-31</th>
      <td>-0.405050</td>
    </tr>
    <tr>
      <th>2000-04-30</th>
      <td>-0.001629</td>
    </tr>
    <tr>
      <th>2000-05-31</th>
      <td>0.248790</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>2.202612</td>
    </tr>
    <tr>
      <th>2000-07-31</th>
      <td>1.483997</td>
    </tr>
    <tr>
      <th>2000-08-31</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>3.127303</td>
    </tr>
    <tr>
      <th>2000-10-31</th>
      <td>3.562381</td>
    </tr>
    <tr>
      <th>2000-11-30</th>
      <td>3.808060</td>
    </tr>
    <tr>
      <th>2000-12-31</th>
      <td>4.153181</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now let’s imagine that there are a number of issues with this time series. First, it’s been recorded wrong: it actually refers to the start of the next month, not the end of the previous as recorded; second, there’s a missing number we want to interpolate; third, we want to take the difference of it to get to something stationary; fourth, we’d like to add a lagged column. We can do all of those things!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change freq to next month start</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;diff_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;lag_diff_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;diff_values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>values</th>
      <th>diff_values</th>
      <th>lag_diff_values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-02-01</th>
      <td>0.360739</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-03-01</th>
      <td>-0.881001</td>
      <td>-1.241739</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-04-01</th>
      <td>-0.405050</td>
      <td>0.475950</td>
      <td>-1.241739</td>
    </tr>
    <tr>
      <th>2000-05-01</th>
      <td>-0.001629</td>
      <td>0.403422</td>
      <td>0.475950</td>
    </tr>
    <tr>
      <th>2000-06-01</th>
      <td>0.248790</td>
      <td>0.250418</td>
      <td>0.403422</td>
    </tr>
    <tr>
      <th>2000-07-01</th>
      <td>2.202612</td>
      <td>1.953822</td>
      <td>0.250418</td>
    </tr>
    <tr>
      <th>2000-08-01</th>
      <td>1.483997</td>
      <td>-0.718615</td>
      <td>1.953822</td>
    </tr>
    <tr>
      <th>2000-09-01</th>
      <td>2.319120</td>
      <td>0.835123</td>
      <td>-0.718615</td>
    </tr>
    <tr>
      <th>2000-10-01</th>
      <td>3.127303</td>
      <td>0.808184</td>
      <td>0.835123</td>
    </tr>
    <tr>
      <th>2000-11-01</th>
      <td>3.562381</td>
      <td>0.435077</td>
      <td>0.808184</td>
    </tr>
    <tr>
      <th>2000-12-01</th>
      <td>3.808060</td>
      <td>0.245680</td>
      <td>0.435077</td>
    </tr>
    <tr>
      <th>2001-01-01</th>
      <td>4.153181</td>
      <td>0.345120</td>
      <td>0.245680</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Add a lead that is 3 months ahead of <code class="docutils literal notranslate"><span class="pre">values</span></code>.</p>
</div>
<p>Two other useful time series functions to be aware of are <code class="docutils literal notranslate"><span class="pre">resample</span></code> and <code class="docutils literal notranslate"><span class="pre">rolling</span></code>. <code class="docutils literal notranslate"><span class="pre">resample</span></code> can upsample or downsample time series. Downsampling is by aggregation, eg <code class="docutils literal notranslate"><span class="pre">df['values].resample('Q').mean()</span></code> to downsample to quarterly (‘Q’) frequency by taking the mean within each quarter. Upsampling involves a choice about how to fill in the missing values; examples of options are <code class="docutils literal notranslate"><span class="pre">bfill</span></code> (backfill) and <code class="docutils literal notranslate"><span class="pre">ffill</span></code> (forwards fill).</p>
<p>There is much more on time series with <strong>pandas</strong> in the Chapter on <a class="reference internal" href="time-series.html#time-series"><span class="std std-ref">Time Series</span></a>.</p>
<p>Rolling is for taking rolling aggregations, as you’d expect; for example, the 3-month rolling mean of our first difference time series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;diff_values&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2000-02-01         NaN
2000-03-01         NaN
2000-04-01         NaN
2000-05-01   -0.120789
2000-06-01    0.376597
2000-07-01    0.869221
2000-08-01    0.495208
2000-09-01    0.690110
2000-10-01    0.308231
2000-11-01    0.692795
2000-12-01    0.496313
2001-01-01    0.341959
Name: diff_values, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><strong>Rolling Groupby</strong></p>
<p>Often there are times when you’d like to compute the rolling mean at the group level, for example for each state. Here’s a typical example of this, and how to compute the grouped rolling mean. This example comes from the excellent <a class="reference external" href="https://calmcode.io">calmcode</a> website.</p>
<p>First, let’s pick up some data that we might want to apply this to and ensure the <code class="docutils literal notranslate"><span class="pre">&quot;date&quot;</span></code> column has the <code class="docutils literal notranslate"><span class="pre">datetime</span></code> datatype:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://calmcode.io/datasets/birthdays.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>wday</th>
      <th>births</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969-01-01</th>
      <td>AK</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>14</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AL</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>174</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AR</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>78</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AZ</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>84</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>CA</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>824</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What we’ll do now is proceed in three steps:</p>
<ol class="simple">
<li><p>Add a date index with <code class="docutils literal notranslate"><span class="pre">.set_index()</span></code>. This is because <code class="docutils literal notranslate"><span class="pre">.rolling</span></code> likes to have a datetime index to work on.</p></li>
<li><p>Group the data with <code class="docutils literal notranslate"><span class="pre">.groupby()</span></code>. Each grouped set will have an index attached and we’re getting a grouped-series object because we’re only selecting the births column.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">.transform()</span></code> to perform an operation only within groups.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;rolling_births&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">)[</span><span class="s1">&#39;births&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;30D&quot;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>wday</th>
      <th>births</th>
      <th>rolling_births</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969-01-01</th>
      <td>AK</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>14</td>
      <td>14.0</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AL</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>174</td>
      <td>174.0</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AR</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>78</td>
      <td>78.0</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>AZ</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>84</td>
      <td>84.0</td>
    </tr>
    <tr>
      <th>1969-01-01</th>
      <td>CA</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>824</td>
      <td>824.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To check that the result is something sensible, you can always sort the dataframe by date and group. Here, that lets us check that the rolling births are indeed following the births column in the way that we expect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>wday</th>
      <th>births</th>
      <th>rolling_births</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1969-01-01</th>
      <td>AK</td>
      <td>1969</td>
      <td>1</td>
      <td>1</td>
      <td>Wed</td>
      <td>14</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>1985-02-20</th>
      <td>AK</td>
      <td>1985</td>
      <td>2</td>
      <td>20</td>
      <td>Wed</td>
      <td>45</td>
      <td>34.100000</td>
    </tr>
    <tr>
      <th>1981-03-15</th>
      <td>AK</td>
      <td>1981</td>
      <td>3</td>
      <td>15</td>
      <td>Sun</td>
      <td>20</td>
      <td>26.633333</td>
    </tr>
    <tr>
      <th>1976-10-20</th>
      <td>AK</td>
      <td>1976</td>
      <td>10</td>
      <td>20</td>
      <td>Wed</td>
      <td>16</td>
      <td>22.000000</td>
    </tr>
    <tr>
      <th>1972-11-12</th>
      <td>AK</td>
      <td>1972</td>
      <td>11</td>
      <td>12</td>
      <td>Sun</td>
      <td>22</td>
      <td>18.466667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For a more in-depth look at combining groups with rolling aggregations, take a look at the <a class="reference external" href="https://calmcode.io/pandas-datetime/rolling-groupby.html">tutorial on calmcode</a>.</p>
</div>
<div class="section" id="advanced-method-chaining">
<h2>Advanced: Method Chaining<a class="headerlink" href="#advanced-method-chaining" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Method Chaining is an advanced topic; feel free to skip it.</p>
</div>
<p>Sometimes, rather than splitting operations out into multiple lines, it can be more concise and clear to chain methods together. A typical time you might do this is when reading in a dataset and perfoming all of the initial cleaning. Tom Augsperger has a <a class="reference external" href="https://tomaugspurger.github.io/method-chaining">great tutorial</a> on this, which I’ve reproduced parts of here. For more info on the <code class="docutils literal notranslate"><span class="pre">pipe</span></code> function used below, check out these short <a class="reference external" href="https://calmcode.io/pandas-pipe/introduction.html">video tutorials</a>.</p>
<p>To chain methods together, both the input and output must be a pandas dataframe. Many functions already do input and output these, for example the <code class="docutils literal notranslate"><span class="pre">df.rename(columns={'old_col':</span> <span class="pre">'new_col'})</span></code> takes in <code class="docutils literal notranslate"><span class="pre">df</span></code> and outputs a dataframe with one column name changed.</p>
<p>But occassionally, we’ll want to use a function that we’ve defined (rather than an already existing one). For that, we need the <code class="docutils literal notranslate"><span class="pre">pipe</span></code> method; it ‘pipes’ the result of one operation to the next operation. When objects are being passed through multiple functions, this can be much clearer. Compare, for example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">h</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">g_arg</span><span class="o">=</span><span class="n">a</span><span class="p">),</span> <span class="n">f_arg</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>that is, dataframe <code class="docutils literal notranslate"><span class="pre">df</span></code> is being passed to function <code class="docutils literal notranslate"><span class="pre">h</span></code>, and the results of that are being passed to a function <code class="docutils literal notranslate"><span class="pre">g</span></code> that needs a key word argument <code class="docutils literal notranslate"><span class="pre">g_arg</span></code>, and the results of <em>that</em> are being passed to a function <code class="docutils literal notranslate"><span class="pre">f</span></code> that needs keyword argument <code class="docutils literal notranslate"><span class="pre">f_arg</span></code>. The nested structure is barely readable. Compare this with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">g_arg</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f_arg</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="p">)</span>  
</pre></div>
</div>
<p>Let’s see a method chain in action on a real dataset so you get a feel for it. We’ll use 1,000 rows of flight data from BTS (a popular online dataset for demos of data cleaning!). TODO use github path. (For further info on method chaining in Python, <a class="reference external" href="https://calmcode.io/method-chains/introduction.html">see these videos</a>–but be aware they assume advanced knowledge of the language.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/aeturrell/coding-for-economists/raw/main/data/flights1kBTS.csv&quot;</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FL_DATE</th>
      <th>OP_UNIQUE_CARRIER</th>
      <th>TAIL_NUM</th>
      <th>ORIGIN</th>
      <th>ORIGIN_CITY_NAME</th>
      <th>DEST</th>
      <th>DEST_CITY_NAME</th>
      <th>DEP_TIME</th>
      <th>ARR_TIME</th>
      <th>ARR_DELAY</th>
      <th>CANCELLATION_CODE</th>
      <th>AIR_TIME</th>
      <th>DISTANCE</th>
      <th>Unnamed: 13</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>403296</th>
      <td>2020-01-20</td>
      <td>G4</td>
      <td>231NV</td>
      <td>SFB</td>
      <td>Sanford, FL</td>
      <td>AVL</td>
      <td>Asheville, NC</td>
      <td>2011.0</td>
      <td>2137.0</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>64.0</td>
      <td>465.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>126199</th>
      <td>2020-01-06</td>
      <td>MQ</td>
      <td>N687JS</td>
      <td>ORD</td>
      <td>Chicago, IL</td>
      <td>MSN</td>
      <td>Madison, WI</td>
      <td>1837.0</td>
      <td>1927.0</td>
      <td>-16.0</td>
      <td>NaN</td>
      <td>26.0</td>
      <td>109.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>417268</th>
      <td>2020-01-20</td>
      <td>YV</td>
      <td>N516LR</td>
      <td>IAD</td>
      <td>Washington, DC</td>
      <td>DTW</td>
      <td>Detroit, MI</td>
      <td>1738.0</td>
      <td>1915.0</td>
      <td>14.0</td>
      <td>NaN</td>
      <td>60.0</td>
      <td>383.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>67589</th>
      <td>2020-01-04</td>
      <td>OO</td>
      <td>N804SK</td>
      <td>SAV</td>
      <td>Savannah, GA</td>
      <td>DTW</td>
      <td>Detroit, MI</td>
      <td>653.0</td>
      <td>844.0</td>
      <td>-26.0</td>
      <td>NaN</td>
      <td>91.0</td>
      <td>705.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>102760</th>
      <td>2020-01-05</td>
      <td>WN</td>
      <td>N789SW</td>
      <td>SAN</td>
      <td>San Diego, CA</td>
      <td>TUS</td>
      <td>Tucson, AZ</td>
      <td>732.0</td>
      <td>941.0</td>
      <td>-19.0</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>368.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We’ll try and do a number of operations in one go: putting column titles in lower case, discarding useless columns, creating precise depature and arrival times, turning some of the variables into categoricals, creating a demeaned delay time, and creating a new categorical column for distances according to quantiles that will be called ‘near’, ‘less near’, ‘far’, and ‘furthest’. Some of these operations require a separate function, so we first define those. When we do the cleaning, we’ll pipe our dataframe to those functions (optionally passing any arguments).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_city_name</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Chicago, IL -&gt; Chicago for origin_city_name and dest_city_name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;origin_city_name&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_city_name&quot;</span><span class="p">]</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;(.*), \w</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;origin_city_name&quot;</span><span class="p">,</span> <span class="s2">&quot;dest_city_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">city</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">time_to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine all time items into datetimes.</span>

<span class="sd">    2014-01-01,0914 -&gt; 2014-01-01 09:14:00</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">converter</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">timepart</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;\.0$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># NaNs force float dtype</span>
            <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">fillchar</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;fl_date&quot;</span><span class="p">]</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="o">+</span> <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
            <span class="o">+</span> <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;Unnamed&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">extract_city_name</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">time_to_datetime</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dep_time&quot;</span><span class="p">,</span> <span class="s2">&quot;arr_time&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">fl_date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;fl_date&quot;</span><span class="p">]),</span>
        <span class="n">dest</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]),</span>
        <span class="n">origin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;origin&quot;</span><span class="p">]),</span>
        <span class="n">tail_num</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;tail_num&quot;</span><span class="p">]),</span>
        <span class="n">arr_delay</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;arr_delay&quot;</span><span class="p">]),</span>
        <span class="n">op_unique_carrier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;op_unique_carrier&quot;</span><span class="p">]),</span>
        <span class="n">arr_delay_demean</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;arr_delay&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;arr_delay&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="n">distance_group</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;near&quot;</span><span class="p">,</span> <span class="s2">&quot;less near&quot;</span><span class="p">,</span> <span class="s2">&quot;far&quot;</span><span class="p">,</span> <span class="s2">&quot;furthest&quot;</span><span class="p">])</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_32015/1424200124.py:22: FutureWarning: The default value of regex will change from True to False in a future version.
  col.astype(str)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fl_date</th>
      <th>op_unique_carrier</th>
      <th>tail_num</th>
      <th>origin</th>
      <th>origin_city_name</th>
      <th>dest</th>
      <th>dest_city_name</th>
      <th>dep_time</th>
      <th>arr_time</th>
      <th>arr_delay</th>
      <th>cancellation_code</th>
      <th>air_time</th>
      <th>distance</th>
      <th>arr_delay_demean</th>
      <th>distance_group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>403296</th>
      <td>2020-01-20</td>
      <td>G4</td>
      <td>231NV</td>
      <td>SFB</td>
      <td>Sanford</td>
      <td>AVL</td>
      <td>Asheville</td>
      <td>2020-01-20 20:11:00</td>
      <td>2020-01-20 21:37:00</td>
      <td>6.0</td>
      <td>NaN</td>
      <td>64.0</td>
      <td>465.0</td>
      <td>8.544995</td>
      <td>less near</td>
    </tr>
    <tr>
      <th>126199</th>
      <td>2020-01-06</td>
      <td>MQ</td>
      <td>N687JS</td>
      <td>ORD</td>
      <td>Chicago</td>
      <td>MSN</td>
      <td>Madison</td>
      <td>2020-01-06 18:37:00</td>
      <td>2020-01-06 19:27:00</td>
      <td>-16.0</td>
      <td>NaN</td>
      <td>26.0</td>
      <td>109.0</td>
      <td>-13.455005</td>
      <td>near</td>
    </tr>
    <tr>
      <th>417268</th>
      <td>2020-01-20</td>
      <td>YV</td>
      <td>N516LR</td>
      <td>IAD</td>
      <td>Washington</td>
      <td>DTW</td>
      <td>Detroit</td>
      <td>2020-01-20 17:38:00</td>
      <td>2020-01-20 19:15:00</td>
      <td>14.0</td>
      <td>NaN</td>
      <td>60.0</td>
      <td>383.0</td>
      <td>16.544995</td>
      <td>less near</td>
    </tr>
    <tr>
      <th>67589</th>
      <td>2020-01-04</td>
      <td>OO</td>
      <td>N804SK</td>
      <td>SAV</td>
      <td>Savannah</td>
      <td>DTW</td>
      <td>Detroit</td>
      <td>2020-01-04 06:53:00</td>
      <td>2020-01-04 08:44:00</td>
      <td>-26.0</td>
      <td>NaN</td>
      <td>91.0</td>
      <td>705.0</td>
      <td>-23.455005</td>
      <td>far</td>
    </tr>
    <tr>
      <th>102760</th>
      <td>2020-01-05</td>
      <td>WN</td>
      <td>N789SW</td>
      <td>SAN</td>
      <td>San Diego</td>
      <td>TUS</td>
      <td>Tucson</td>
      <td>2020-01-05 07:32:00</td>
      <td>2020-01-05 09:41:00</td>
      <td>-19.0</td>
      <td>NaN</td>
      <td>53.0</td>
      <td>368.0</td>
      <td>-16.455005</td>
      <td>less near</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="reshaping-data">
<h2>Reshaping data<a class="headerlink" href="#reshaping-data" title="Permalink to this headline">¶</a></h2>
<p>The main options for reshaping data are <code class="docutils literal notranslate"><span class="pre">pivot</span></code>, <code class="docutils literal notranslate"><span class="pre">melt</span></code>, <code class="docutils literal notranslate"><span class="pre">stack</span></code>, <code class="docutils literal notranslate"><span class="pre">unstack</span></code>, <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>, <code class="docutils literal notranslate"><span class="pre">get_dummies</span></code>, <code class="docutils literal notranslate"><span class="pre">cross_tab</span></code>, and <code class="docutils literal notranslate"><span class="pre">explode</span></code>. We’ll look at some of these here.</p>
<div class="section" id="pivoting-data-from-tidy-to-err-untidy">
<h3>Pivoting data from tidy to, err, untidy<a class="headerlink" href="#pivoting-data-from-tidy-to-err-untidy" title="Permalink to this headline">¶</a></h3>
<p>At the start of this chapter, I said you should use tidy data–one row per observation, one column per variable–whenever you can. But there are times when you will want to take your lovingly prepared tidy data and pivot it into a wider format. <code class="docutils literal notranslate"><span class="pre">pivot</span></code> and <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> help you to do that.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/reshaping_pivot.png" /></p>
<p>This can be especially useful for time series data, where operations like <code class="docutils literal notranslate"><span class="pre">shift</span></code> or <code class="docutils literal notranslate"><span class="pre">diff</span></code> are typically applied assuming that an entry in one row follows (in time) from the one above. Here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="n">prng</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;type1&quot;</span><span class="p">,</span> <span class="s2">&quot;type2&quot;</span><span class="p">,</span> <span class="s2">&quot;type3&quot;</span><span class="p">,</span> <span class="s2">&quot;type4&quot;</span><span class="p">],</span> <span class="mi">20</span><span class="p">),</span>
    <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))</span>
        <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))</span>
    <span class="p">),</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>variable</th>
      <th>category</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>2000-05-31</td>
      <td>A</td>
      <td>type3</td>
      <td>-0.876566</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2000-03-31</td>
      <td>B</td>
      <td>type4</td>
      <td>0.875889</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2000-09-30</td>
      <td>B</td>
      <td>type1</td>
      <td>1.157198</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2000-01-31</td>
      <td>B</td>
      <td>type3</td>
      <td>0.515731</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2000-04-30</td>
      <td>B</td>
      <td>type1</td>
      <td>-0.127172</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we just run <code class="docutils literal notranslate"><span class="pre">shift</span></code> on this, it’s going to shift variable B’s and A’s together even though these overlap in time. So we pivot to a wider format (and then we can shift safely).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>variable</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-31</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2000-02-29</th>
      <td>-0.777410</td>
      <td>0.515731</td>
    </tr>
    <tr>
      <th>2000-03-31</th>
      <td>-0.530698</td>
      <td>0.098430</td>
    </tr>
    <tr>
      <th>2000-04-30</th>
      <td>0.352288</td>
      <td>0.875889</td>
    </tr>
    <tr>
      <th>2000-05-31</th>
      <td>-2.219487</td>
      <td>-0.127172</td>
    </tr>
    <tr>
      <th>2000-06-30</th>
      <td>-0.876566</td>
      <td>-0.486642</td>
    </tr>
    <tr>
      <th>2000-07-31</th>
      <td>-2.209528</td>
      <td>-1.193658</td>
    </tr>
    <tr>
      <th>2000-08-31</th>
      <td>1.470469</td>
      <td>0.539450</td>
    </tr>
    <tr>
      <th>2000-09-30</th>
      <td>0.540615</td>
      <td>-1.189509</td>
    </tr>
    <tr>
      <th>2000-10-31</th>
      <td>-2.125918</td>
      <td>1.157198</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To go back to the original structure, albeit without the <code class="docutils literal notranslate"><span class="pre">category</span></code> columns, apply <code class="docutils literal notranslate"><span class="pre">.unstack().reset_index()</span></code>.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Perform a pivot that applies to both the <code class="docutils literal notranslate"><span class="pre">variable</span></code> and <code class="docutils literal notranslate"><span class="pre">category</span></code> columns. (Hint: remember that you will need to pass multiple objects via a list.)</p>
</div>
</div>
<div class="section" id="melt">
<h3>Melt<a class="headerlink" href="#melt" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">melt</span></code> can help you go from untidy to tidy data (from wide data to long data), and is a <em>really</em> good one to remember. Of course, I have to look at the documentation every single time myself, but I’m sure you’ll do better.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/reshaping_melt.png" /></p>
<p>Here’s an example of it in action:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;first&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="s2">&quot;Mary&quot;</span><span class="p">],</span>
        <span class="s2">&quot;last&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;Bo&quot;</span><span class="p">],</span>
        <span class="s2">&quot;job&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Nurse&quot;</span><span class="p">,</span> <span class="s2">&quot;Economist&quot;</span><span class="p">],</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>
        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">130</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Unmelted: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Melted: &quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;quantity&quot;</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Unmelted: 
  first last        job  height  weight
0  John  Doe      Nurse     5.5     130
1  Mary   Bo  Economist     6.0     150

 Melted: 
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>first</th>
      <th>last</th>
      <th>quantity</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>John</td>
      <td>Doe</td>
      <td>height</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mary</td>
      <td>Bo</td>
      <td>height</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>John</td>
      <td>Doe</td>
      <td>weight</td>
      <td>130.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mary</td>
      <td>Bo</td>
      <td>weight</td>
      <td>150.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Perform a melt that uses <code class="docutils literal notranslate"><span class="pre">job</span></code> as the id instead of <code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code>.</p>
</div>
<p>If you don’t wan the headscratching of melt, there’s also <code class="docutils literal notranslate"><span class="pre">wide_to_long</span></code>, which is really useful for typical data cleaning cases where you have data like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;A1970&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">},</span>
        <span class="s2">&quot;A1980&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">},</span>
        <span class="s2">&quot;B1970&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">},</span>
        <span class="s2">&quot;B1980&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
        <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A1970</th>
      <th>A1980</th>
      <th>B1970</th>
      <th>B1980</th>
      <th>X</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>d</td>
      <td>2.5</td>
      <td>3.2</td>
      <td>-0.741526</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b</td>
      <td>e</td>
      <td>1.2</td>
      <td>1.3</td>
      <td>-1.201757</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c</td>
      <td>f</td>
      <td>0.7</td>
      <td>0.1</td>
      <td>1.523690</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>i.e. data where there are different variables and time periods across the columns. Wide to long is going to let us give info on what the stubnames are (‘A’, ‘B’), the name of the variable that’s always across columns (here, a year), any values (X here), and an id column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">wide_to_long</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stubnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span> <span class="n">i</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>X</th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>id</th>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>1970</th>
      <td>-0.741526</td>
      <td>a</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>1</th>
      <th>1970</th>
      <td>-1.201757</td>
      <td>b</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>2</th>
      <th>1970</th>
      <td>1.523690</td>
      <td>c</td>
      <td>0.7</td>
    </tr>
    <tr>
      <th>0</th>
      <th>1980</th>
      <td>-0.741526</td>
      <td>d</td>
      <td>3.2</td>
    </tr>
    <tr>
      <th>1</th>
      <th>1980</th>
      <td>-1.201757</td>
      <td>e</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>2</th>
      <th>1980</th>
      <td>1.523690</td>
      <td>f</td>
      <td>0.1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="stack-and-unstack">
<h3>Stack and unstack<a class="headerlink" href="#stack-and-unstack" title="Permalink to this headline">¶</a></h3>
<p>Stack, <code class="docutils literal notranslate"><span class="pre">stack()</span></code> is a shortcut for taking a single type of wide data variable from columns and turning it into a long form dataset, but with an extra index.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/reshaping_stack.png" /></p>
<p>Unstack, <code class="docutils literal notranslate"><span class="pre">unstack()</span></code> unsurprisingly does the same operation, but in reverse.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/reshaping_unstack.png" /></p>
<p>Let’s define a multi-index dataframe to demonstrate this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;qux&quot;</span><span class="p">,</span> <span class="s2">&quot;qux&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>A</th>
      <th>B</th>
    </tr>
    <tr>
      <th>first</th>
      <th>second</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">bar</th>
      <th>one</th>
      <td>-0.046251</td>
      <td>-0.180298</td>
    </tr>
    <tr>
      <th>two</th>
      <td>2.081910</td>
      <td>0.846520</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">baz</th>
      <th>one</th>
      <td>1.313378</td>
      <td>0.251507</td>
    </tr>
    <tr>
      <th>two</th>
      <td>0.830822</td>
      <td>0.339911</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">foo</th>
      <th>one</th>
      <td>-1.117795</td>
      <td>0.715364</td>
    </tr>
    <tr>
      <th>two</th>
      <td>1.841748</td>
      <td>-0.736528</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">qux</th>
      <th>one</th>
      <td>-1.158760</td>
      <td>-1.138809</td>
    </tr>
    <tr>
      <th>two</th>
      <td>-0.549319</td>
      <td>0.862525</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s stack this to create a tidy dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>first  second   
bar    one     A   -0.046251
               B   -0.180298
       two     A    2.081910
               B    0.846520
baz    one     A    1.313378
               B    0.251507
       two     A    0.830822
               B    0.339911
foo    one     A   -1.117795
               B    0.715364
       two     A    1.841748
               B   -0.736528
qux    one     A   -1.158760
               B   -1.138809
       two     A   -0.549319
               B    0.862525
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This has automatically created a multi-layered index but that can be reverted to a numbered index using <code class="docutils literal notranslate"><span class="pre">df.reset_index()</span></code></p>
<p>Now let’s see unstack but, instead of unstacking the ‘A’, ‘B’ variables we began with, let’s unstack the ‘first’ column by passing <code class="docutils literal notranslate"><span class="pre">level=0</span></code> (the default is to unstack the innermost index). This diagram shows what’s going on:</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/reshaping_unstack_0.png" /></p>
<p>And here’s the code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>first</th>
      <th>bar</th>
      <th>baz</th>
      <th>foo</th>
      <th>qux</th>
    </tr>
    <tr>
      <th>second</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">one</th>
      <th>A</th>
      <td>-0.046251</td>
      <td>1.313378</td>
      <td>-1.117795</td>
      <td>-1.158760</td>
    </tr>
    <tr>
      <th>B</th>
      <td>-0.180298</td>
      <td>0.251507</td>
      <td>0.715364</td>
      <td>-1.138809</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">two</th>
      <th>A</th>
      <td>2.081910</td>
      <td>0.830822</td>
      <td>1.841748</td>
      <td>-0.549319</td>
    </tr>
    <tr>
      <th>B</th>
      <td>0.846520</td>
      <td>0.339911</td>
      <td>-0.736528</td>
      <td>0.862525</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>What happens if you unstack to <code class="docutils literal notranslate"><span class="pre">level=1</span></code> instead? What about applying <code class="docutils literal notranslate"><span class="pre">unstack()</span></code> twice?</p>
</div>
</div>
<div class="section" id="get-dummies">
<h3>Get dummies<a class="headerlink" href="#get-dummies" title="Permalink to this headline">¶</a></h3>
<p>This is a really useful reshape command for when you want (explicit) dummies in your dataframe. When running simple regressions, you can achieve the same effect by declaring the column only be included as a fixed effect, but there are some machine learning packages where converting to dummies may be easier.</p>
<p>Here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;group_var&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;group1&quot;</span><span class="p">,</span> <span class="s2">&quot;group2&quot;</span><span class="p">,</span> <span class="s2">&quot;group3&quot;</span><span class="p">],</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;group_var&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  group_var  B  C
0    group1  c  1
1    group2  c  2
2    group3  b  3
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>group_var_group1</th>
      <th>group_var_group2</th>
      <th>group_var_group3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>c</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>c</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>b</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="combining-data">
<h2>Combining data<a class="headerlink" href="#combining-data" title="Permalink to this headline">¶</a></h2>
<p><strong>pandas</strong> has a really rich set of options for combining one or more dataframes. The two most important are concatenate and merge.</p>
<div class="section" id="concatenate">
<h3>Concatenate<a class="headerlink" href="#concatenate" title="Permalink to this headline">¶</a></h3>
<p>If you have two or more dataframes with the same index or the same columns, you can glue them together into a single dataframe using <code class="docutils literal notranslate"><span class="pre">pd.concat</span></code>.</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/08_concat_row.svg" /></p>
<p>For the same columns, pass <code class="docutils literal notranslate"><span class="pre">axis=0</span></code> to glue the index together; for the same index, pass <code class="docutils literal notranslate"><span class="pre">axis=1</span></code> to glue the columns together. The concatenate function will typically be used on a list of dataframes.</p>
<p>If you want to track where the original data came from in the final dataframe, use the <code class="docutils literal notranslate"><span class="pre">keys</span></code> keyword.</p>
<p>Here’s an example using data on two different states’ populations that also makes uses of the <code class="docutils literal notranslate"><span class="pre">keys</span></code> option:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;http://www.stata-press.com/data/r14/&quot;</span>
<span class="n">state_codes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ca&quot;</span><span class="p">,</span> <span class="s2">&quot;il&quot;</span><span class="p">]</span>
<span class="n">end_url</span> <span class="o">=</span> <span class="s2">&quot;pop.dta&quot;</span>

<span class="c1"># This grabs the two dataframes, one for each state</span>
<span class="n">list_of_state_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_stata</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="n">end_url</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">state_codes</span><span class="p">]</span>
<span class="c1"># Show example of first entry in list of dataframes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list_of_state_dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Concatenate the list of dataframes</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">list_of_state_dfs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">state_codes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        county      pop
0  Los Angeles  9878554
1       Orange  2997033
2      Ventura   798364
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>county</th>
      <th>pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">ca</th>
      <th>0</th>
      <td>Los Angeles</td>
      <td>9878554</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Orange</td>
      <td>2997033</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Ventura</td>
      <td>798364</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">il</th>
      <th>0</th>
      <td>Cook</td>
      <td>5285107</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DeKalb</td>
      <td>103729</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Will</td>
      <td>673586</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">keys</span></code> argument is optional, but is useful for keeping track of origin dataframes within the merged dataframe.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Concatenate the follow two dataframes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;letter&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">])</span>

<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span>
                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;letter&#39;</span><span class="p">,</span> <span class="s1">&#39;number&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="merge">
<h3>Merge<a class="headerlink" href="#merge" title="Permalink to this headline">¶</a></h3>
<p>There are so many options for merging dataframes using <code class="docutils literal notranslate"><span class="pre">pd.merge(left,</span> <span class="pre">right,</span> <span class="pre">on=...,</span> <span class="pre">how=...</span></code> that we won’t be able to cover them all here. The most important features are: the two dataframes to be merged, what variables (aka keys) to merge on (and these can be indexes) via <code class="docutils literal notranslate"><span class="pre">on=</span></code>, and <em>how</em> to do the merge (eg left, right, outer, inner) via <code class="docutils literal notranslate"><span class="pre">how=</span></code>. This diagram shows an example of a merge using keys from the left-hand dataframe:</p>
<p><img alt="" src="https://pandas.pydata.org/docs/_images/08_merge_left.svg" /></p>
<p>The <code class="docutils literal notranslate"><span class="pre">how=</span></code> keyword works in the following ways:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">how='left'</span></code> uses keys from the left dataframe only to merge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">how='right'</span></code> uses keys from the right dataframe only to merge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">how='inner'</span></code> uses keys that appear in both dataframes to merge.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">how='outer'</span></code> uses the cartesian product of keys in both dataframes to merge on.</p></li>
</ul>
<p>Let’s see examples of some of these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">],</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A0&quot;</span><span class="p">,</span> <span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="s2">&quot;A3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;B0&quot;</span><span class="p">,</span> <span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;B2&quot;</span><span class="p">,</span> <span class="s2">&quot;B3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K1&quot;</span><span class="p">,</span> <span class="s2">&quot;K2&quot;</span><span class="p">],</span>
        <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K0&quot;</span><span class="p">,</span> <span class="s2">&quot;K0&quot;</span><span class="p">],</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="s2">&quot;C3&quot;</span><span class="p">],</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;D0&quot;</span><span class="p">,</span> <span class="s2">&quot;D1&quot;</span><span class="p">,</span> <span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D3&quot;</span><span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1"># Right merge</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K2</td>
      <td>K0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that the key combination of K2 and K0 did not exist in the left-hand dataframe, and so its entries in the final dataframe are NaNs. But it <em>does</em> have entries because we chose the keys from the right-hand dataframe.</p>
<p>What about an inner merge?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we see that the combination K2 and K0 are excluded because they didn’t exist in the overlap of keys in both dataframes.</p>
<p>Finally, let’s take a look at an outer merge that comes with some extra info via the <code class="docutils literal notranslate"><span class="pre">indicator</span></code> keyword:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key1</th>
      <th>key2</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>_merge</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>K0</td>
      <td>K0</td>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
      <td>both</td>
    </tr>
    <tr>
      <th>1</th>
      <td>K0</td>
      <td>K1</td>
      <td>A1</td>
      <td>B1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>2</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C1</td>
      <td>D1</td>
      <td>both</td>
    </tr>
    <tr>
      <th>3</th>
      <td>K1</td>
      <td>K0</td>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
      <td>both</td>
    </tr>
    <tr>
      <th>4</th>
      <td>K2</td>
      <td>K1</td>
      <td>A3</td>
      <td>B3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>left_only</td>
    </tr>
    <tr>
      <th>5</th>
      <td>K2</td>
      <td>K0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>C3</td>
      <td>D3</td>
      <td>right_only</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we can see that the products of all key combinations are here. The <code class="docutils literal notranslate"><span class="pre">indicator=True</span></code> option has caused an extra column to be added, called ‘_merge’, that tells us which dataframe the keys on that row came from.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Merge the following two dataframes using the <code class="docutils literal notranslate"><span class="pre">left_on</span></code> and <code class="docutils literal notranslate"><span class="pre">right_on</span></code> keyword arguments to specify a join on <code class="docutils literal notranslate"><span class="pre">lkey</span></code> and <code class="docutils literal notranslate"><span class="pre">rkey</span></code> respectively:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;lkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rkey&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<p>Merge the following two dataframes on <code class="docutils literal notranslate"><span class="pre">&quot;a&quot;</span></code> using <code class="docutils literal notranslate"><span class="pre">how=&quot;left&quot;</span></code> as a keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
</pre></div>
</div>
<p>What do you notice about the position <code class="docutils literal notranslate"><span class="pre">.loc[1,</span> <span class="pre">&quot;c&quot;]</span></code> in the merged dataframe?</p>
</div>
<p>For more on the options for merging, see <strong>pandas</strong>’ comprehensive <a class="reference external" href="https://pandas.pydata.org/docs/user_guide/merging.html#database-style-dataframe-or-named-series-joining-merging">merging documentation</a>.</p>
</div>
</div>
<div class="section" id="advanced-alternatives-to-pandas">
<h2>Advanced: alternatives to <strong>pandas</strong><a class="headerlink" href="#advanced-alternatives-to-pandas" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re just starting to code, you can safely skip this section.</p>
</div>
<p><strong>pandas</strong> isn’t the only game in town, not by a long way—though it’s by far the best supported and the most fully featured. <strong>pandas</strong> is a good default package to use for data in the vast majority of cases. But it’s always good to have options—or, put another way, options have value! Other dataframe libraries may have a syntax that you prefer (<strong>datatable</strong>’s syntax is popular with some) or provide a speed-up in certain situations, for example when working with large datasets (<strong>polars</strong> promises to breeze through big data far faster than pandas can).</p>
<p>If you’re specifically interested in how different dataframe options perform on increasingly large datasets, take a look at the benchmarks <a class="reference external" href="https://h2oai.github.io/db-benchmark/">here</a>.</p>
<p>Here’s a quick run-through of some alternatives to <strong>pandas</strong>:</p>
<div class="section" id="datatable">
<h3>Datatable<a class="headerlink" href="#datatable" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://datatable.readthedocs.io/en/latest/"><strong>datatable</strong></a> is another dataframe based way to do analysis, and it has quite a different syntax to <strong>pandas</strong> for data manipulation. <strong>datatable</strong> is very fast, not the fastest dataframe option out there, but it holds its own. Its other major advantage is that it is comfortable running on extremely large (think 50GB) datasets. Most other dataframe packages (including in other languages) cannot cope with this.</p>
<p>I am indebted to the very well-written datatable documentation for the rest of this demonstration.</p>
<p>In datatable, almost all operations are achieved via so-called ‘square-bracket notation’. Operations with a (data) Frame are almost all expressed in the form</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">DT</span></code> is a datatable dataframe, <code class="docutils literal notranslate"><span class="pre">i</span></code> is the row selector, <code class="docutils literal notranslate"><span class="pre">j</span></code> is the column selector, and <code class="docutils literal notranslate"><span class="pre">...</span></code> is a space that could be filled by other commands (potentially several). However, <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code> aren’t just positional, as they might be in a <strong>numpy</strong> array or a list, they do a lot more than that.</p>
<p>Datatable allows <code class="docutils literal notranslate"><span class="pre">i</span></code> to be anything that can conceivably be interpreted as a row selector: an integer to select a row, a slice, a range, a list of integers, a list of slices, an expression, a boolean-valued Frame, an integer-valued Frame, an integer <strong>numpy</strong> array, a generator, and more.</p>
<p>Likewise, <code class="docutils literal notranslate"><span class="pre">j</span></code> is also really versatile. It can be used to select a column by name or position, but it will also accept a list of columns, a slice, a list of booleans indicating which columns to pick, an expression, a list of expressions, and a dictionary of expressions. The j expression can even be a python type (such as int or dt.float32), selecting all columns matching that type!</p>
<p>To change an entry (entries), you can use <code class="docutils literal notranslate"><span class="pre">DT[i,</span> <span class="pre">j]</span> <span class="pre">=</span> <span class="pre">new_value</span></code>, and to remove it (or them), it’s <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">DT[i,</span> <span class="pre">j]</span></code>.</p>
<p>It’s probably going to be easiest to see some examples, so let’s do a quick run through of some functions with the storms dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datatable</span> <span class="kn">import</span> <span class="n">dt</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">sort</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">ifelse</span>

<span class="n">DT</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">fread</span><span class="p">(</span><span class="s2">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/dplyr/storms.csv&quot;</span><span class="p">)</span>

<span class="n">DT</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type='text/css'>
.datatable table.frame { margin-bottom: 0; }
.datatable table.frame thead { border-bottom: none; }
.datatable table.frame tr.coltypes td {  color: #FFFFFF;  line-height: 6px;  padding: 0 0.5em;}
.datatable .bool    { background: #DDDD99; }
.datatable .object  { background: #565656; }
.datatable .int     { background: #5D9E5D; }
.datatable .float   { background: #4040CC; }
.datatable .str     { background: #CC4040; }
.datatable .row_index {  background: var(--jp-border-color3);  border-right: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  font-size: 9px;}
.datatable .frame tr.coltypes .row_index {  background: var(--jp-border-color0);}
.datatable th:nth-child(2) { padding-left: 12px; }
.datatable .hellipsis {  color: var(--jp-cell-editor-border-color);}
.datatable .vellipsis {  background: var(--jp-layout-color0);  color: var(--jp-cell-editor-border-color);}
.datatable .na {  color: var(--jp-cell-editor-border-color);  font-size: 80%;}
.datatable .footer { font-size: 9px; }
.datatable .frame_dimensions {  background: var(--jp-border-color3);  border-top: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  display: inline-block;  opacity: 0.6;  padding: 1px 10px 1px 5px;}
</style>
</div><div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>C0</th><th>name</th><th>year</th><th>month</th><th>day</th><th>hour</th><th>lat</th><th>long</th><th>status</th><th>category</th><th>wind</th><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>1</td><td>Amy</td><td>1975</td><td>6</td><td>27</td><td>0</td><td>27.5</td><td>&minus;79</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>1</td><td>2</td><td>Amy</td><td>1975</td><td>6</td><td>27</td><td>6</td><td>28.5</td><td>&minus;79</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>2</td><td>3</td><td>Amy</td><td>1975</td><td>6</td><td>27</td><td>12</td><td>29.5</td><td>&minus;79</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>3</td><td>4</td><td>Amy</td><td>1975</td><td>6</td><td>27</td><td>18</td><td>30.5</td><td>&minus;79</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>4</td><td>5</td><td>Amy</td><td>1975</td><td>6</td><td>28</td><td>0</td><td>31.5</td><td>&minus;78.8</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1012</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>5 rows &times; 14 columns</div>
  </div>
</div>
</div></div>
</div>
<p>Yes, that’s right, you’re seeing columns colour coded by data type! Otherwise, what you can see here is that the syntax so far looks quite similar but don’t worry because it’s about to get weird.</p>
<p>The square brackets accept expressions, i.e. functions. This is achieved through a special import, simply denoted <code class="docutils literal notranslate"><span class="pre">f</span></code>, that says do this thing to the current datatable. For example, to filter by a certain value in the ‘status’ column (to avoid overloading with data, I’ll just use head to show the first few rows):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;tropical storm&quot;</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>C0</th><th>name</th><th>year</th><th>month</th><th>day</th><th>hour</th><th>lat</th><th>long</th><th>status</th><th>category</th><th>wind</th><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>9</td><td>Amy</td><td>1975</td><td>6</td><td>29</td><td>0</td><td>34.4</td><td>&minus;75.8</td><td>tropical storm</td><td>0</td><td>35</td><td>1004</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>1</td><td>10</td><td>Amy</td><td>1975</td><td>6</td><td>29</td><td>6</td><td>34</td><td>&minus;74.8</td><td>tropical storm</td><td>0</td><td>40</td><td>1002</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>2</td><td>11</td><td>Amy</td><td>1975</td><td>6</td><td>29</td><td>12</td><td>33.8</td><td>&minus;73.8</td><td>tropical storm</td><td>0</td><td>45</td><td>1000</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>3</td><td>12</td><td>Amy</td><td>1975</td><td>6</td><td>29</td><td>18</td><td>33.8</td><td>&minus;72.8</td><td>tropical storm</td><td>0</td><td>50</td><td>998</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 14 columns</div>
  </div>
</div>
</div></div>
</div>
<p>Let’s get rid of some columns we’re not using right now</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">DT</span><span class="p">[:,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span><span class="s2">&quot;long&quot;</span><span class="p">]</span>
<span class="n">DT</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>C0</th><th>name</th><th>status</th><th>category</th><th>wind</th><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>1</td><td>Amy</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>1</td><td>2</td><td>Amy</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>2</td><td>3</td><td>Amy</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
    <tr><td class='row_index'>3</td><td>4</td><td>Amy</td><td>tropical depression</td><td>&minus;1</td><td>25</td><td>1013</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 8 columns</div>
  </div>
</div>
</div></div>
</div>
<p>Now, to select only those columns that are strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="nb">str</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>name</th><th>status</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>Amy</td><td>tropical depression</td></tr>
    <tr><td class='row_index'>1</td><td>Amy</td><td>tropical depression</td></tr>
    <tr><td class='row_index'>2</td><td>Amy</td><td>tropical depression</td></tr>
    <tr><td class='row_index'>3</td><td>Amy</td><td>tropical depression</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 2 columns</div>
  </div>
</div>
</div></div>
</div>
<p>Or to select only those columns that contain ‘diameter’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">DT</span><span class="o">.</span><span class="n">names</span> <span class="k">if</span> <span class="s2">&quot;diameter&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>ts_diameter</th><th>hu_diameter</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>161.109</td><td>23.0156</td></tr>
    <tr><td class='row_index'>1</td><td>207.14</td><td>23.0156</td></tr>
    <tr><td class='row_index'>2</td><td>345.234</td><td>34.5234</td></tr>
    <tr><td class='row_index'>3</td><td>379.757</td><td>46.0312</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 2 columns</div>
  </div>
</div>
</div></div>
</div>
<p>To create a new column based on an existing one and just look at the last few columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="n">update</span><span class="p">(</span><span class="n">atmospheres</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">pressure</span> <span class="o">/</span> <span class="mf">1013.0</span><span class="p">)]</span>
<span class="n">DT</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th><th>atmospheres</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>990</td><td>161.109</td><td>23.0156</td><td>0.977295</td></tr>
    <tr><td class='row_index'>1</td><td>985</td><td>207.14</td><td>23.0156</td><td>0.972359</td></tr>
    <tr><td class='row_index'>2</td><td>980</td><td>345.234</td><td>34.5234</td><td>0.967423</td></tr>
    <tr><td class='row_index'>3</td><td>980</td><td>379.757</td><td>46.0312</td><td>0.967423</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 4 columns</div>
  </div>
</div>
</div></div>
</div>
<p>To sort all values by multiple columns:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">sort</span><span class="p">(</span><span class="s2">&quot;wind&quot;</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>C0</th><th>name</th><th>status</th><th>category</th><th>wind</th><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th><th>atmospheres</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>1844</td><td>Gilbert</td><td>hurricane</td><td>5</td><td>160</td><td>888</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.876604</td></tr>
    <tr><td class='row_index'>1</td><td>7266</td><td>Wilma</td><td>hurricane</td><td>5</td><td>160</td><td>882</td><td>304.957</td><td>74.8007</td><td>0.870681</td></tr>
    <tr><td class='row_index'>2</td><td>4802</td><td>Mitch</td><td>hurricane</td><td>5</td><td>155</td><td>910</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.898322</td></tr>
    <tr><td class='row_index'>3</td><td>4801</td><td>Mitch</td><td>hurricane</td><td>5</td><td>155</td><td>905</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.893386</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 9 columns</div>
  </div>
</div>
</div></div>
</div>
<p>And to perform group-by operations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="n">dt</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">wind</span><span class="p">),</span> <span class="n">by</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>status</th><th>wind</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>hurricane</td><td>85.9689</td></tr>
    <tr><td class='row_index'>1</td><td>tropical depression</td><td>27.2692</td></tr>
    <tr><td class='row_index'>2</td><td>tropical storm</td><td>45.8059</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>3 rows &times; 2 columns</div>
  </div>
</div>
</div></div>
</div>
<p>And, finally, one that I always find of great practical use–the within-group transform, with the new column going back into the original data(frame/table). In <strong>pandas</strong>, this is achieved by <code class="docutils literal notranslate"><span class="pre">transform</span></code>, here we use <code class="docutils literal notranslate"><span class="pre">extend</span></code>. Let’s demonstrate by showing the maximum wind speed by status group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DT</span><span class="p">[:,</span> <span class="n">f</span><span class="p">[:]</span><span class="o">.</span><span class="n">extend</span><span class="p">({</span><span class="s2">&quot;max_wind&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">wind</span><span class="p">)}),</span> <span class="n">by</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div class='datatable'>
  <table class='frame'>
  <thead>
    <tr class='colnames'><td class='row_index'></td><th>status</th><th>C0</th><th>name</th><th>category</th><th>wind</th><th>pressure</th><th>ts_diameter</th><th>hu_diameter</th><th>atmospheres</th><th>max_wind</th></tr>
    <tr class='coltypes'><td class='row_index'></td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='str' title='str32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='float' title='float64'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td><td class='int' title='int32'>&#x25AA;&#x25AA;&#x25AA;&#x25AA;</td></tr>
  </thead>
  <tbody>
    <tr><td class='row_index'>0</td><td>hurricane</td><td>53</td><td>Caroline</td><td>1</td><td>65</td><td>990</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.977295</td><td>65</td></tr>
    <tr><td class='row_index'>1</td><td>hurricane</td><td>54</td><td>Caroline</td><td>1</td><td>65</td><td>990</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.977295</td><td>65</td></tr>
    <tr><td class='row_index'>2</td><td>hurricane</td><td>55</td><td>Caroline</td><td>1</td><td>65</td><td>989</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.976308</td><td>65</td></tr>
    <tr><td class='row_index'>3</td><td>hurricane</td><td>56</td><td>Caroline</td><td>1</td><td>70</td><td>987</td><td><span class=na>NA</span></td><td><span class=na>NA</span></td><td>0.974334</td><td>65</td></tr>
  </tbody>
  </table>
  <div class='footer'>
    <div class='frame_dimensions'>4 rows &times; 10 columns</div>
  </div>
</div>
</div></div>
</div>
</div>
<div class="section" id="cudf">
<h3>cuDF<a class="headerlink" href="#cudf" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/rapidsai/cudf"><strong>cuDF</strong></a> is still under development and so doesn’t yet have all the features of <strong>pandas</strong>. It’s a Python GPU DataFrame library built on the blisteringly fast Apache Arrow columnar memory format. The parts of the library that have been implemented follow the same commands and structure as <strong>pandas</strong>, so it should be easy to use it should you need to.</p>
<p><strong>cuDF</strong> is one of the fastest dataframe library out there in any of Python, Julia, Rust, or R with the caveats that:</p>
<ul class="simple">
<li><p>this only applies to in-memory datasets, ie datasets smaller than a few GB</p></li>
<li><p>it doesn’t yet do everything</p></li>
<li><p>it’s only currently available on the Linux operating system</p></li>
<li><p>you need a GPU (and associated software) to use it!</p></li>
</ul>
</div>
<div class="section" id="polars">
<h3>Polars<a class="headerlink" href="#polars" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.pola.rs/"><strong>Polars</strong></a> is consistently the fastest dataframe library in any of Python, Julia, Rust, or R. It also uses Apache Arrow as backend. It currently consists of an ‘eager’ (for datasets smaller than approximately a few GB) interface that’s very similar to <strong>pandas</strong> and a ‘lazy’ interface (don’t worry if you don’t know what that means, it’s a big data thing) that is somewhat similar to spark (a big data tool). <strong>Polars</strong> is built on the Rust language. It’s particularly effective at merging datasets.</p>
</div>
<div class="section" id="plydata">
<h3>Plydata<a class="headerlink" href="#plydata" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://plydata.readthedocs.io">Plydata</a> uses the syntax of the <strong>dplyr</strong> package in the R statistical language (the package is a really important part of the data ecosystem in R). It’s built around method chaining and everything being in a tidy format, which has pros and cons. Largely, the benefits are in readability and a smaller number of commands to cover the ground that you need to. The downsides are that it plays best with tidy data and when chained methods go wrong it can be more difficult to find out what the issue is.</p>
</div>
<div class="section" id="datar">
<h3>Datar<a class="headerlink" href="#datar" title="Permalink to this headline">¶</a></h3>
<p>Another library that gets close to <strong>dplylr</strong> syntax is <a class="reference external" href="https://github.com/pwwang/datar"><strong>datar</strong></a>. Like <strong>plydata</strong>, it integrates with <strong>plotnine</strong> for visualisation.</p>
</div>
<div class="section" id="others">
<h3>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/kieferk/dfply">dfplyr</a> also follows the syntax of the <strong>dplyr</strong> package in R but it does not appear to be under active development.</p></li>
<li><p><a class="reference external" href="https://github.com/machow/siuba">siuba</a> is yet another <strong>dplyr</strong> inspired package! It is under active development.</p></li>
</ul>
</div>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<p>If you know:</p>
<ul class="simple">
<li><p>✅ what tidy data are;</p></li>
<li><p>✅ how to create series and dataframes with different datatypes;</p></li>
<li><p>✅ how to access values in series and dataframes;</p></li>
<li><p>✅ how to perform operations on columns;</p></li>
<li><p>✅ how to use the split-apply-combine pattern;</p></li>
<li><p>✅ how to reshape data;</p></li>
<li><p>✅ how to combine and merge different dataframes; and</p></li>
<li><p>✅ what some alternatives to <strong>pandas</strong> are</p></li>
</ul>
<p>then you are well on your way to becoming a data analysis master!</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="data-analysis-quickstart.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Data Analysis Quickstart</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="data-exploratory-analysis.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Exploratory Data Analysis</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Arthur Turrell<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            This book is available under an MIT license.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-189705534-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>