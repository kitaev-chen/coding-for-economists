
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Coding &#8212; Coding for Economists</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/code-advanced.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Options for Writing Code" href="code-where.html" />
    <link rel="prev" title="Basics of Coding" href="code-basics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/smith_lovelace.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Coding for Economists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coding
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="code-preliminaries.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-basics.html">
   Basics of Coding
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Advanced Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-where.html">
   Options for Writing Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Workflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-best-practice.html">
   Tips for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-advcd-best-practice.html">
   Tools for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-command-line.html">
   The Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-rap.html">
   Reproducible Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data-analysis-quickstart.html">
   Data Analysis Quickstart
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-intro.html">
   Working with Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-exploratory-analysis.html">
   Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-read-and-write.html">
   Reading and Writing Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-extraction.html">
   Getting Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-sharing.html">
   Sharing Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-advanced.html">
   Advanced Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Visualisation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="vis-intro.html">
   Intro to Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-common-plots.html">
   Common Plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-narrative.html">
   Narrative Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-animation.html">
   Animation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-probability-random.html">
   Probability and Random Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-statistics.html">
   Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-regression.html">
   Regression
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Text Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="text-intro.html">
   Introduction to Text
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-nlp.html">
   Natural Language Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time-intro.html">
   Introduction to Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-series.html">
   Time Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-fcasts-env.html">
   Forecasting Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Geospatial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="geo-intro.html">
   Intro to Geo-Spatial Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geo-vis.html">
   Geo-Spatial Visualisation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematics with Code
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="maths-maths-coding.html">
   Intro to Mathematics with Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Automation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="auto-research-outputs.html">
   Automating Research Outputs
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coming from ...
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-stata.html">
   Coming from Stata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-matlab.html">
   Coming from Matlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-r.html">
   Coming from R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-excel.html">
   Coming from Excel
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Elsewhere
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/code-advanced.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/aeturrell/coding-for-economists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fcode-advanced.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/aeturrell/coding-for-economists/main?urlpath=tree/code-advanced.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/code-advanced.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sets">
   Sets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#higher-order-functions">
   Higher order functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#map-filter-and-reduce">
   Map, filter, and reduce
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map">
     Map
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filter">
     Filter
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduce">
     Reduce
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#truthy-and-falsy-values">
   Truthy and falsy values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#iterators">
   Iterators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generators">
   Generators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decorators">
   Decorators
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#errors-and-exceptions">
   Errors and exceptions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#classes-and-objects">
   Classes and objects
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataclassess">
     Dataclassess
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tests">
   Tests
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-continuous-variables">
     Testing continuous variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-coverage">
     Test coverage
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-annotations-and-type-checkers">
   Type annotations and type checkers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#timing-and-profiling">
   Timing and profiling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#i-am-the-walrus">
   I am the Walrus
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multiple-dispatch">
   Multiple dispatch
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="advanced-coding">
<span id="code-advanced"></span><h1>Advanced Coding<a class="headerlink" href="#advanced-coding" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re just starting to code, you can safely skip this chapter.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This chapter covers some more advanced programming concepts. It’s not strictly necessary to master the content of the book, but it’s here in case you want a deeper understanding or in case you find that you eventually need to draw on more sophisticated programming tools and concepts.</p>
<p>This chapter has benefitted from the online book <a class="reference external" href="https://merely-useful.github.io/py-rse/"><em>Research Software Engineering with Python</em></a>, the <a class="reference external" href="https://www.python.org/">official Python documentation</a>, the excellent <a class="reference external" href="https://github.com/Asabeneh/30-Days-Of-Python">30 days of Python</a>, and the <a class="reference external" href="https://docs.python-guide.org/">Hitchhiker’s Guide to Python</a>.</p>
</div>
<div class="section" id="sets">
<h2>Sets<a class="headerlink" href="#sets" title="Permalink to this headline">¶</a></h2>
<p>A set in coding is a collection of unordered and unindexed distinct elements (in analogy to the mathematical definition of a set). To define a set, the two commands are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># or</span>
<span class="n">st</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>These aren’t very interesting though! Here’s a set with some values in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">people_set</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Robinson&quot;</span><span class="p">,</span> <span class="s2">&quot;Fawcett&quot;</span><span class="p">,</span> <span class="s2">&quot;Ostrom&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>What can we do with it? We can check its length using <code class="docutils literal notranslate"><span class="pre">len(people_set)</span></code> and we can ask whether a particular entry is contained within it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Ostrom&quot;</span> <span class="ow">in</span> <span class="n">people_set</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>We can add multiple items or another set using <code class="docutils literal notranslate"><span class="pre">.update</span></code> or <code class="docutils literal notranslate"><span class="pre">.union</span></code>, or a single item using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">people_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Martineau&quot;</span><span class="p">)</span>
<span class="n">people_set</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Fawcett&#39;, &#39;Martineau&#39;, &#39;Ostrom&#39;, &#39;Robinson&#39;}
</pre></div>
</div>
</div>
</div>
<p>We can remove entries with <code class="docutils literal notranslate"><span class="pre">.remove(entry_name)</span></code> or, to remove only the last entry <code class="docutils literal notranslate"><span class="pre">.pop()</span></code>. You can easily convert between lists and sets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">people_set</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Martineau&#39;, &#39;Ostrom&#39;, &#39;Robinson&#39;, &#39;Fawcett&#39;]
</pre></div>
</div>
</div>
</div>
<p>The real benefits of sets are that they support set operations, though. The most important are <code class="docutils literal notranslate"><span class="pre">intersection</span></code>,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item1&quot;</span><span class="p">,</span> <span class="s2">&quot;item2&quot;</span><span class="p">,</span> <span class="s2">&quot;item3&quot;</span><span class="p">,</span> <span class="s2">&quot;item4&quot;</span><span class="p">}</span>
<span class="n">st2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item3&quot;</span><span class="p">,</span> <span class="s2">&quot;item2&quot;</span><span class="p">}</span>
<span class="n">st1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;item2&#39;, &#39;item3&#39;}
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">difference</span></code>,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item1&quot;</span><span class="p">,</span> <span class="s2">&quot;item2&quot;</span><span class="p">,</span> <span class="s2">&quot;item3&quot;</span><span class="p">,</span> <span class="s2">&quot;item4&quot;</span><span class="p">}</span>
<span class="n">st2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item2&quot;</span><span class="p">,</span> <span class="s2">&quot;item3&quot;</span><span class="p">}</span>
<span class="n">st1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">st2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;item1&#39;, &#39;item4&#39;}
</pre></div>
</div>
</div>
</div>
<p>and symmetric difference,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">st1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item1&quot;</span><span class="p">,</span> <span class="s2">&quot;item2&quot;</span><span class="p">,</span> <span class="s2">&quot;item3&quot;</span><span class="p">,</span> <span class="s2">&quot;item4&quot;</span><span class="p">}</span>
<span class="n">st2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;item2&quot;</span><span class="p">,</span> <span class="s2">&quot;item3&quot;</span><span class="p">}</span>
<span class="n">st2</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">st1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;item1&#39;, &#39;item4&#39;}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="higher-order-functions">
<h2>Higher order functions<a class="headerlink" href="#higher-order-functions" title="Permalink to this headline">¶</a></h2>
<p>Functions are like any other variable in Python, which means you can do some interesting things with them and, well, it can get a bit <em>meta</em>. For example, a function can take one or more functions as parameters, a function can be returned as a result of another function, functions can be defined within functions, a function can be assigned to a variable, and you can iterate over functions (for example, if they are in a list).</p>
<p>Here’s an example that shows how to use a higher order function: it accepts a function, <code class="docutils literal notranslate"><span class="pre">f</span></code>, as an argument and then, using the splat operator <code class="docutils literal notranslate"><span class="pre">*</span></code>, it accepts all arguments of that function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">join_a_string</span><span class="p">(</span><span class="n">str_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">higher_order_function</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Lowers case of result&quot;&quot;&quot;</span>
    <span class="n">out_string</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out_string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">higher_order_function</span><span class="p">(</span><span class="n">join_a_string</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="s2">&quot;World!&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>hello world!
</pre></div>
</div>
</div>
</div>
<p>In the next example, we show how to return a function from a function (assigning a function, <code class="docutils literal notranslate"><span class="pre">result</span></code>, to a variable in the process):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">cube</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">higher_order_function</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>  <span class="c1"># a higher order function returning a function</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;square&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">square</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;cube&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cube</span>


<span class="n">result</span> <span class="o">=</span> <span class="n">higher_order_function</span><span class="p">(</span><span class="s2">&quot;square&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using higher_order_function(&#39;square&#39;), result(3) yields </span><span class="si">{</span><span class="n">result</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">higher_order_function</span><span class="p">(</span><span class="s2">&quot;cube&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using higher_order_function(&#39;cube&#39;), result(3) yields </span><span class="si">{</span><span class="n">result</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using higher_order_function(&#39;square&#39;), result(3) yields 9
Using higher_order_function(&#39;cube&#39;), result(3) yields 27
</pre></div>
</div>
</div>
</div>
<p>Functions within functions are allowed. They are known as <em>closures</em>. Here’s a simple (if contrived) example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="k">def</span> <span class="nf">print_time_now</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">get_curr_time</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M&quot;</span><span class="p">)</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">get_curr_time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>


<span class="n">print_time_now</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22:28
</pre></div>
</div>
</div>
</div>
<p>Finally, let’s see how to iterate over functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">square_root</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">functions_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">square_root</span><span class="p">,</span> <span class="n">square</span><span class="p">,</span> <span class="n">cube</span><span class="p">]</span>

<span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">functions_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> applied to 4 is </span><span class="si">{</span><span class="n">func</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>square_root applied to 4 is 2.0
square applied to 4 is 16
cube applied to 4 is 64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="map-filter-and-reduce">
<h2>Map, filter, and reduce<a class="headerlink" href="#map-filter-and-reduce" title="Permalink to this headline">¶</a></h2>
<p>Map, filter, and reduce are built-in higher order functions. Lambda functions, featured in the basics of coding chapter, can be passed as into each of these as an argument and some of the best use cases of lambda functions are in conjunction with map, filter, and reduce.</p>
<div class="section" id="map">
<h3>Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">map</span></code> takes a function and an iterable as arguments, ie the syntax is <code class="docutils literal notranslate"><span class="pre">map(function,</span> <span class="pre">iterable)</span></code>. An iterable is a type that is composed of elements that can be iterated over. The map essentially applies the function to each entry in the iterable. Here’s an example where a list of strings is cast to integers via <code class="docutils literal notranslate"><span class="pre">map</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbers_str</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">]</span>
<span class="n">mapped_result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">numbers_str</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">mapped_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2, 3, 4, 5]
</pre></div>
</div>
</div>
</div>
<p>Here’s an example with a lambda function. The benefit of using a lambda in this map operation is that otherwise we would have to write a whole function that simply returned the input with <code class="docutils literal notranslate"><span class="pre">.title()</span></code> at the end:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;robinson&quot;</span><span class="p">,</span> <span class="s2">&quot;fawcett&quot;</span><span class="p">,</span> <span class="s2">&quot;ostrom&quot;</span><span class="p">]</span>
<span class="n">names_titled</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">names</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">names_titled</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Robinson&#39;, &#39;Fawcett&#39;, &#39;Ostrom&#39;]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filter">
<h3>Filter<a class="headerlink" href="#filter" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">filter</span></code> calls a specified function and returns a boolean for each item of the specified iterable. It filters the items that satisfy the given boolean criteria. It uses the <code class="docutils literal notranslate"><span class="pre">filter(function,</span> <span class="pre">iterable)</span></code> syntax. In the example below, we take all the numbers from zero to five and filter them according to whether they are divisible by 2:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">fil_result</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">fil_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 2, 4]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reduce">
<h3>Reduce<a class="headerlink" href="#reduce" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">reduce</span></code> is defined in the built-in <code class="docutils literal notranslate"><span class="pre">functools</span></code> module. Like <code class="docutils literal notranslate"><span class="pre">map</span></code> and <code class="docutils literal notranslate"><span class="pre">filter</span></code>, <code class="docutils literal notranslate"><span class="pre">reduce</span></code> takes two parameters, a function and an iterable. However, it returns a single value rather than another iterable. The way <code class="docutils literal notranslate"><span class="pre">reduce</span></code> works is to apply operations successively so that the example below effectively first sums 2 and 3 to make 5, then 5 and 5 to make 10, then 10 and 15 to make 25, and, finally, 25 and 20 to make the final result of 45.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>45
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="truthy-and-falsy-values">
<h2>Truthy and falsy values<a class="headerlink" href="#truthy-and-falsy-values" title="Permalink to this headline">¶</a></h2>
<p>Python objects can be used in expressions that will return a boolean value, such as when a list, <code class="docutils literal notranslate"><span class="pre">listy</span></code>, is used with <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">listy</span></code>. Built-in Python objects that are empty are usually evaluated as <code class="docutils literal notranslate"><span class="pre">False</span></code>, and are said to be ‘Falsy’. In contrast, when these built-in objects are not empty, they evaluate as <code class="docutils literal notranslate"><span class="pre">True</span></code> and are said to be ‘truthy’.</p>
<p>(If you are building your own classes, you can define this behaviour for them through the <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> dunder method.)</p>
<p>Let’s see some examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bool_check_var</span><span class="p">(</span><span class="n">input_variable</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">input_variable</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Falsy&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Truthy&quot;</span><span class="p">)</span>


<span class="n">listy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">other_listy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>


<span class="n">bool_check_var</span><span class="p">(</span><span class="n">listy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Falsy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bool_check_var</span><span class="p">(</span><span class="n">other_listy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Truthy
</pre></div>
</div>
</div>
</div>
<p>The method we defined doesn’t just operate on lists; it’ll work for many various other truthy and falsy objects:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bool_check_var</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Falsy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bool_check_var</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Truthy
</pre></div>
</div>
</div>
</div>
<p>Note that zero was falsy, its the nothing of a float, but a list of three zeros is not an empty list, so it evaluates as truthy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bool_check_var</span><span class="p">({})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Falsy
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bool_check_var</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Falsy
</pre></div>
</div>
</div>
</div>
<p>Knowing what is truthy or falsy is useful in practice; imagine you’d like to default to a specific behaviour if a list called <code class="docutils literal notranslate"><span class="pre">list_vals</span></code> doesn’t have any values in. You now know you can do it simply with <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">list_vals</span></code>.</p>
</div>
<div class="section" id="iterators">
<h2>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<p>An iterator is an object that contains a countable number of values that a single command, <code class="docutils literal notranslate"><span class="pre">next</span></code>, iterates through. Before that’s possible though, we need to take a countable group of some kind and use the <code class="docutils literal notranslate"><span class="pre">iter</span></code> keyword on it to turn it into an iterator. Let’s see an example with some text:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_lst</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mumbai&quot;</span><span class="p">,</span> <span class="s2">&quot;Delhi&quot;</span><span class="p">,</span> <span class="s2">&quot;Bangalore&quot;</span><span class="p">]</span>

<span class="n">myiterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">text_lst</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Okay, nothing has happened yet, but that’s because we didn’t call it yet. To get the next iteration, whatever it is, use <code class="docutils literal notranslate"><span class="pre">next</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">myiterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Mumbai&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">myiterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Delhi&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">myiterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Bangalore&#39;
</pre></div>
</div>
</div>
</div>
<p>Alright, we’ve been through all of the values so… what’s going to happen <code class="docutils literal notranslate"><span class="pre">next</span></code>!?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">myiterator</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">StopIteration</span>                             <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">27</span><span class="o">-</span><span class="mi">29</span><span class="n">fb3b4dbbec</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="nb">next</span><span class="p">(</span><span class="n">myiterator</span><span class="p">)</span>

<span class="ne">StopIteration</span><span class="p">:</span> 
</pre></div>
</div>
<p>Iterating beyond the end raises a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> error because we reached the end. To keep going, use <code class="docutils literal notranslate"><span class="pre">cycle</span></code> in place of <code class="docutils literal notranslate"><span class="pre">iter</span></code>. Note that you can build your own iterators (here we used a built-in object type, the <code class="docutils literal notranslate"><span class="pre">list</span></code>, to create an iterator of type <code class="docutils literal notranslate"><span class="pre">list_iterator</span></code>).</p>
</div>
<div class="section" id="generators">
<h2>Generators<a class="headerlink" href="#generators" title="Permalink to this headline">¶</a></h2>
<p>Generator functions return ‘lazy’ iterators. They are lazy because they do not store their contents in memory. This has <em>big</em> advantages for some operations in specific situations: datasets larger than can fit into your computer’s memory, or a complex function that needs to maintain an internal state every time it’s called.</p>
<p>To give an idea of how and when they work, imagine that (exogeneously) integers are really costly, taking as much as 10 MB of space to store (the real figure is more like 128 bytes). We will write a function, “firstn”, that represents the first <span class="math notranslate nohighlight">\(n\)</span> non-negative integers, where <span class="math notranslate nohighlight">\(n\)</span> is large. The most naive possible way of doing this would be to build the full list in memory like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">first_n_naive</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Build and return a list&quot;&quot;&quot;</span>
    <span class="n">num</span><span class="p">,</span> <span class="n">nums</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">nums</span>


<span class="n">sum_of_first_n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">first_n_naive</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>
<span class="n">sum_of_first_n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>499999500000
</pre></div>
</div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">nums</span></code> stores <em>every</em> number before returning all of them. In our imagined case, this is completely infeasible because we don’t have enough computer space to keep all <span class="math notranslate nohighlight">\(n\)</span> 10MB integers in memory.</p>
<p>Now we’ll rewrite the list-based function as a generator-based function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">first_n_generator</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A generator that yields items instead of returning a list&quot;&quot;&quot;</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">num</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="n">sum_of_first_n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">first_n_generator</span><span class="p">(</span><span class="mi">1000000</span><span class="p">))</span>
<span class="n">sum_of_first_n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>499999500000
</pre></div>
</div>
</div>
</div>
<p>Now, instead of creating an enormous list that has to be stored in memory, we <code class="docutils literal notranslate"><span class="pre">yield</span></code> up each number as it is ‘generated’. The cleverness that’s going on here is that  the ‘state’ of the function is remembered from one call to the next. This means that when <code class="docutils literal notranslate"><span class="pre">next</span></code> is called on a generator object (either explicitly or implicitly, as in this example), the previously yielded variable <code class="docutils literal notranslate"><span class="pre">num</span></code> is incremented, and then yielded again.</p>
<p>That was a fairly contrived example but there are plenty of practical ones. Working with pipelines that process very large datasets is a classic use case. For example, imagine you have a csv file that’s far too big to fit in memory, i.e. open all at once, but you’d like to check the contents of each row and perhaps process them. The code below would <code class="docutils literal notranslate"><span class="pre">yield</span></code> each row in turn.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">csv_reader</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">row</span>
</pre></div>
</div>
<p>An even more concise way of defining this is via a <em>generator expression</em>, which syntactically looks a lot like a <em>list comprehension</em> but is a generator rather than a list. The example we just saw would be written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">csv_gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
</pre></div>
</div>
<p>It’s easier to see the difference in the below example which clearly shows the analogy between <em>list comprehensions</em> and <em>generator comprehensions</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sq_nums_lc</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
<span class="n">sq_nums_lc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4, 9, 16, 25]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sq_nums_gc</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sq_nums_gc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator object &lt;genexpr&gt; at 0x7fc766c3f350&gt;
</pre></div>
</div>
</div>
</div>
<p>The latter is a generator object and we can only access individual values calling <code class="docutils literal notranslate"><span class="pre">next</span></code> on it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">sq_nums_gc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<p>Note that for small numbers of entries, lists may actually be faster and more efficient than generators-but for large numbers of entries, generators will almost always win out.</p>
</div>
<div class="section" id="decorators">
<h2>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h2>
<p>Decorators ‘decorate’ functions, they adorn them, modifying them as they execute. Let’s say we want to run some numerical functions but we’d like to add ten on to whatever results we get. We could do it like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">num_one</span><span class="p">,</span> <span class="n">num_two</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num_one</span> <span class="o">*</span> <span class="n">num_two</span>


<span class="k">def</span> <span class="nf">add_ten</span><span class="p">(</span><span class="n">in_num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">in_num</span> <span class="o">+</span> <span class="mi">10</span>


<span class="n">answer</span> <span class="o">=</span> <span class="n">add_ten</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">answer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22
</pre></div>
</div>
</div>
</div>
<p>This is fine for a one-off but a bit tedious if we’re going to be using <code class="docutils literal notranslate"><span class="pre">add_ten</span></code> a lot, and on many functions. Decorators allow for a more general solution that can be applied, in this case, to any <code class="docutils literal notranslate"><span class="pre">inner</span></code> function that has two arguments and returns a numeric value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_ten</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="k">return</span> <span class="n">inner</span>


<span class="nd">@add_ten</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">num_one</span><span class="p">,</span> <span class="n">num_two</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num_one</span> <span class="o">*</span> <span class="n">num_two</span>


<span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22
</pre></div>
</div>
</div>
</div>
<p>We can use the same decorator for a different function (albeit one of the same form) now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@add_ten</span>
<span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">num_one</span><span class="p">,</span> <span class="n">num_two</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num_one</span> <span class="o">/</span> <span class="n">num_two</span>


<span class="n">divide</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.0
</pre></div>
</div>
</div>
</div>
<p>But the magic of decorators is such that we can define them for much more general cases, regardless of the number of arguments or even keyword arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_ten</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Function has been decorated!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding ten...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="k">return</span> <span class="n">inner</span>


<span class="nd">@add_ten</span>
<span class="k">def</span> <span class="nf">combine_three_nums</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">c</span>


<span class="nd">@add_ten</span>
<span class="k">def</span> <span class="nf">combine_four_nums</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">d</span>


<span class="n">combine_three_nums</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function has been decorated!
Adding ten...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10
</pre></div>
</div>
</div>
</div>
<p>Let’s now see it applied to a function with a different number of (keyword) arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">combine_four_nums</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Function has been decorated!
Adding ten...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>18
</pre></div>
</div>
</div>
</div>
<p>Decorators can be chained too (and order matters):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dividing_line</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;-&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">return</span> <span class="n">inner</span>


<span class="nd">@dividing_line</span>
<span class="nd">@add_ten</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">num_one</span><span class="p">,</span> <span class="n">num_two</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num_one</span> <span class="o">*</span> <span class="n">num_two</span>


<span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>------------------------------
Function has been decorated!
Adding ten...
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="errors-and-exceptions">
<h2>Errors and exceptions<a class="headerlink" href="#errors-and-exceptions" title="Permalink to this headline">¶</a></h2>
<p>When a programme goes wrong, it throws up an error and halts. You won’t be coding for long before you hit one of these errors, which have special names depending on what triggered them.</p>
<p>Let’s see a real-life error in action:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">denom</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span>                         <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">39</span><span class="o">-</span><span class="n">e45c0e0a3e37</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="n">denom</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="mi">2</span> 
<span class="o">----&gt;</span> <span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span>

<span class="ne">ZeroDivisionError</span><span class="p">:</span> <span class="n">division</span> <span class="n">by</span> <span class="n">zero</span>
</pre></div>
</div>
<p>Oh no! We got a <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> and our programme crashed. Note that the error includes a ‘Traceback’ to show which line went wrong, which is helpful for debugging.</p>
<p>In practice, there are often times when we know that an error <em>could</em> arise, and we would like to specify what should happen when it does (rather than having the programme crash).</p>
<p>We can use <em>exceptions</em> to do this. These come in a <code class="docutils literal notranslate"><span class="pre">try</span></code> … <code class="docutils literal notranslate"><span class="pre">except</span></code> pattern, which looks like an <code class="docutils literal notranslate"><span class="pre">if</span></code> … <code class="docutils literal notranslate"><span class="pre">else</span></code> pattern but applies to errors. If no errors occur inside the <code class="docutils literal notranslate"><span class="pre">try</span></code> block, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block isn’t run but <em>if</em> something goes wrong inside the <code class="docutils literal notranslate"><span class="pre">try</span></code> then the <code class="docutils literal notranslate"><span class="pre">except</span></code> block is executed. Let’s see an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">denom</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot divide by </span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
Cannot divide by 0
1/5 == 0.2
</pre></div>
</div>
</div>
</div>
<p>Now we can see two differences. First: the code executed just fine <em>without</em> halting. Second: when we hit the error, the <code class="docutils literal notranslate"><span class="pre">except</span></code> block was executed and told us what was going on.</p>
<p>In this case, we wrote an informative message about the error but it’s convenient to use Python’s built in messages where we can. In the below, not only do we send our own message about the error but we add info on what caused the error for the language too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">denom</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> has no reciprocal; error is: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
0 has no reciprocal; error is: division by zero
1/5 == 0.2
</pre></div>
</div>
</div>
</div>
<p>Sadly, division by zero is just one of the many errors you might encounter. What if a function is likely to end up running into several different errors? We can have multiple <code class="docutils literal notranslate"><span class="pre">except</span></code> clauses to catch these:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1/</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;index </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> out of range; error is </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">denom</span><span class="si">}</span><span class="s2"> has no reciprocal; error is: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1/-5 == -0.2
0 has no reciprocal; error is: division by zero
1/5 == 0.2
index 3 out of range; error is list index out of range
</pre></div>
</div>
</div>
</div>
<p>A full list of built-in errors may be <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy">found here</a> and they are nested in classes (eg <code class="docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code> is a special case of a <code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code>).</p>
<p>Where do these errors come from anyway? What tells the programming language to throw a tantrum when it encounters certain combinations of values and operations.</p>
<p>The answer is that the person or people who wrote the code that’s ‘under the hood’ can specify when such errors should be raised. Remember, the philosophy of Python is that things should faily loudly (so that they do not cause issues downstream). Here’s an example of some code that raises its own errors using the <code class="docutils literal notranslate"><span class="pre">raise</span></code> keyword:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;no negatives: </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;exception: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
0
exception: no negatives: -1
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> is a built-in type of error and there are plenty of ones to choose from for your case. Some big or specialised libraries define their own types of error too.</p>
<p>One very clever feature of Python’s exception handling is “throw low, catch high”, which means that even if an error gets thrown way deep down in the middle of a code block, the catching exception can be used some way away. Here’s an example: the error arises <em>within</em> the <code class="docutils literal notranslate"><span class="pre">sum_reciprocals</span></code> function, but is caught elsewhere.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sum_reciprocals</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">one_over</span> <span class="o">=</span> <span class="n">sum_reciprocals</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ArithmeticError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error trying to sum reciprocals: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error trying to sum reciprocals: division by zero
</pre></div>
</div>
</div>
</div>
<p>Here’s an example of combining a <code class="docutils literal notranslate"><span class="pre">try</span></code>, several <code class="docutils literal notranslate"><span class="pre">except</span></code> statements, an <code class="docutils literal notranslate"><span class="pre">else</span></code> that gets executed if <code class="docutils literal notranslate"><span class="pre">try</span></code> is, and a <code class="docutils literal notranslate"><span class="pre">finally</span></code> that always get executed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">b_year</span> <span class="o">=</span> <span class="mi">1852</span>
<span class="n">name_input</span> <span class="o">=</span> <span class="s2">&quot;Ada&quot;</span>


<span class="k">def</span> <span class="nf">process_input</span><span class="p">(</span><span class="n">name_input</span><span class="p">,</span> <span class="n">b_year</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name_input</span><span class="p">)</span>
        <span class="n">year_born</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b_year</span><span class="p">)</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">year_born</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You are </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. And your age is </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type error occur&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Value error occur&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;zero division error occur&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I usually run with the try block&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I always run.&quot;</span><span class="p">)</span>


<span class="n">process_input</span><span class="p">(</span><span class="n">name_input</span><span class="p">,</span> <span class="n">b_year</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You are Ada. And your age is 169.
I usually run with the try block
I always run.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="classes-and-objects">
<h2>Classes and objects<a class="headerlink" href="#classes-and-objects" title="Permalink to this headline">¶</a></h2>
<p>Python is an object oriented programming language. Everything is an object (and every object has a type). A Class is an object constructor, a blueprint for creating objects. An object is a ‘live’ instance of a class. Objects are to classes what a yellow VW Beetle is to cars. The class defines the attributes and methods that the object can perform.</p>
<p>Classes and instances of them are useful in certain situations, the most common being when you need something that has ‘state’, i.e. it can remember things that have happened to it, carry information with it, and change form.</p>
<p>While you’re quite unlikely to need to build classes in economics (unless you’re doing something really fancy), some of the biggest Python packages are based around classes so it’s useful to understand a bit about how they work, and especially how they have state.</p>
<p>The syntax to create a class is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ClassName</span><span class="p">:</span>
  <span class="o">...</span><span class="n">code</span><span class="o">...</span>
</pre></div>
</div>
<p>But it’s easiest to show with an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a class called Person</span>


<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>


<span class="c1"># Create an instance of the class</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Adam&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When we check <code class="docutils literal notranslate"><span class="pre">type</span></code>, that’s when it gets <em>really</em> interesting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>__main__.Person
</pre></div>
</div>
</div>
</div>
<p>Woah! We created a whole new data type based on the <code class="docutils literal notranslate"><span class="pre">Class</span></code> name. The class has a constructor method, <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, that, in this case, takes an input variable <code class="docutils literal notranslate"><span class="pre">name</span></code> and assigns it to an <em>internal</em> object variable <code class="docutils literal notranslate"><span class="pre">name</span></code>. The <code class="docutils literal notranslate"><span class="pre">self</span></code> variable that you can also see is really saying ‘generate an object of type this Class when called’. We can access any internal variables like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Adam&#39;
</pre></div>
</div>
</div>
</div>
<p>Okay but what’s the point of all this? Well we can now create as many objects as we like of class ‘Person’ and they will have the same structure, but not the same state, as other objects of class ‘Person’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Ada&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Ada&#39;
</pre></div>
</div>
</div>
</div>
<p>This is a very boring class! Let’s add a method, which will allow us to change the state of objects. Here, we add a method <code class="docutils literal notranslate"><span class="pre">increment_age</span></code> which is also indented under the <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">Person</span></code> header. Note that it takes <code class="docutils literal notranslate"><span class="pre">self</span></code> as an input, just like the constructor, but it only acts on objects of type person that have <em>already</em> been created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="k">def</span> <span class="nf">increment_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="mi">1</span>


<span class="c1"># Create an instance of the class</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Adam&quot;</span><span class="p">,</span> <span class="mi">231</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c1"># Call the method increment_age</span>
<span class="n">p</span><span class="o">.</span><span class="n">increment_age</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>231
232
</pre></div>
</div>
</div>
</div>
<p>This very simple method changes the internal state. Just like class constructors and regular functions, class methods can take arguments. Here’s an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="k">def</span> <span class="nf">increment_age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">change_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">new_age</span>


<span class="c1"># Create an instance of the class</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Adam&quot;</span><span class="p">,</span> <span class="mi">231</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c1"># Call the method increment_age</span>
<span class="n">p</span><span class="o">.</span><span class="n">change_age</span><span class="p">(</span><span class="mi">67</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>231
67
</pre></div>
</div>
</div>
</div>
<p>It can be tedious to have to initialise a class with a whole load of parameters every time. Just like with functions, we can define <em>default parameters</em> for classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;default_name&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>


<span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;default_name&#39;
</pre></div>
</div>
</div>
</div>
<p>That covers a lot of the basics of classes but if you’re using classes in anger then you might also want to look up <a class="reference external" href="https://realpython.com/inheritance-composition-python/">inheritance and composition</a>.</p>
<div class="section" id="dataclassess">
<h3>Dataclassess<a class="headerlink" href="#dataclassess" title="Permalink to this headline">¶</a></h3>
<p>The basic classes we created above come with a lot of ‘boilerplate’; code we need but which is not very surprising. Dataclasses were inroduced in Python 3.7 as a way to remove this boilerplate when the classes being created are quite simple. Think of dataclasses as a class with sensible defaults that is for light object-oriented programming.</p>
<p>A simple example, with a <code class="docutils literal notranslate"><span class="pre">Circle</span></code> class, demonstrates why they are effective. First, the full class way of doing things:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">Circle1</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">colour</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colour</span> <span class="o">=</span> <span class="n">colour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">circle1</span> <span class="o">=</span> <span class="n">Circle1</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circle1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;__main__.Circle1 at 0x7fc766be3c10&gt;
</pre></div>
</div>
</div>
</div>
<p>We don’t get a very informative message when we call <code class="docutils literal notranslate"><span class="pre">circle1</span></code>, as you can see. At least we can compute its area:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">circle1</span><span class="o">.</span><span class="n">area</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.566370614359172
</pre></div>
</div>
</div>
</div>
<p>Now we’ll create the same object with dataclasses</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Circle2</span><span class="p">:</span>
    <span class="n">colour</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">circle2</span> <span class="o">=</span> <span class="n">Circle2</span><span class="p">(</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circle2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Circle2(colour=&#39;blue&#39;, radius=2)
</pre></div>
</div>
</div>
</div>
<p>Right away we get a much more informative message when we call the object, <em>and</em> the class definition is a whole lot simpler. Everything else is just the same (just try calling <code class="docutils literal notranslate"><span class="pre">circle2.area()</span></code>).</p>
</div>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>Tests check that your code is behaving as you expect, even as parts of it change or are updated. They most commonly compare an expected input and output with what actually comes out of your code for a given input.</p>
<p>Writing tests for code is often an after thought for research code, if it’s a thought at all. That’s understandable. But it can really boost reliability and robustness. This excerpt from <a class="reference external" href="https://merely-useful.github.io/py-rse/testing.html">Research Software Engineering with Python</a> explains why testing even research code is extremely useful:</p>
<blockquote>
<div><p>Why is testing research software important? A successful early career researcher in protein crystallography, Geoffrey Chang, had to retract five published papers—three from the journal Science—because his code had inadvertently flipped two columns of data (Miller 2006). More recently, a simple calculation mistake in a paper by Reinhart and Rogoff contributed to making the financial crash of 2008 even worse for millions of people (Borwein and Bailey 2013). Testing helps to catch errors like these.</p>
</div></blockquote>
<p>The Reinhart and Rogoff paper used Excel for its analysis; while Excel has some pros and does some good in the world, my strong recommendation is that it should <em>not</em> be used for any important analysis.</p>
<p>Back to testing: if you’re writing a <em>package</em> of code for others to use, one that will change and grow over time, tests are essential. These are some general guidelines for good testing, such as:</p>
<ul class="simple">
<li><p>A testing ‘unit’ should focus on a single bit of functionality;</p></li>
<li><p>Each test unit must be fully independent (in practice, this means that <code class="docutils literal notranslate"><span class="pre">setUp()</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown()</span></code> methods need to be defined to prep data or objects to the point where they can be used by the testing unit);</p></li>
<li><p>Tests should run fast if possible;</p></li>
<li><p>If you know how, it’s a good idea to use something like a ‘Git hook’ that runs tests before code is saved in a shared repository;</p></li>
<li><p>If you find a bug in your code, it’s good practice to write a new test that targets it; and</p></li>
<li><p>Although long, extremely descriptive names are not very helpful in regular code, they <em>should</em> be used for functions that test code because this is the name you will see when the test fails (and you want to know what it refers to).</p></li>
</ul>
<p>The most common way to run tests is to add assertions to code. An assertion is a statement that something must be true at a certain point in a program. When an assertion evaluates to true, nothing happens; if it’s false, the programme stops and prints a user-defined error message. Here’s an example of an assertion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>If we had run</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&lt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>it would have resulted in</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------</span>
<span class="ne">AssertionError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">55</span><span class="o">-</span><span class="n">db0e55fa5cb7</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
      <span class="mi">1</span> <span class="n">positive_num</span> <span class="o">=</span> <span class="mi">5</span>
      <span class="mi">2</span> 
<span class="o">----&gt;</span> <span class="mi">3</span> <span class="k">assert</span> <span class="n">positive_num</span> <span class="o">&lt;</span> <span class="mi">0</span>

<span class="ne">AssertionError</span><span class="p">:</span>
</pre></div>
</div>
<p>Putting assertions into code here and there is one way to check that everything is working as you anticipate, but you won’t find out about it until you actually run the code! A testing framework allows you to separate checking the code behaves as you’d expect from running the code, so that you can ensure everything works before putting that big run on.</p>
<p>To run lots of tests, we can use a test framework (also called a test runner). A commonly used test framework is <a class="reference external" href="https://docs.pytest.org/en/latest/"><strong>pytest</strong></a>. Essentially it will run anything that you’ve flagged as a test in your code and report back to you on whether it passed or not. Here’s how it works: tests are put in files whose names begin with <code class="docutils literal notranslate"><span class="pre">test_</span></code>, each test is a function whose name also begins with <code class="docutils literal notranslate"><span class="pre">test_</span></code>, and these functions use <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements to check results.</p>
<p>Normally, your functions would be in a different script but here’s an example of a code function and a testing function (that tests it) that you might put in a file called <code class="docutils literal notranslate"><span class="pre">test.py</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of test.py</span>
<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">test_answer</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">inc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<p>To run this, we would enter</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest
</pre></div>
</div>
<p>on the command line. This would yield</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">===========================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">============================</span>
platform linux -- Python <span class="m">3</span>.x.y, pytest-6.x.y, py-1.x.y, pluggy-0.x.y
cachedir: <span class="nv">$PYTHON_PREFIX</span>/.pytest_cache
rootdir: <span class="nv">$REGENDOC_TMPDIR</span>
collected <span class="m">1</span> item

test.py F                                                     <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=================================</span> <span class="nv">FAILURES</span> <span class="o">=================================</span>
_______________________________ test_answer ________________________________

    def test_answer<span class="o">()</span>:
&gt;       assert inc<span class="o">(</span><span class="m">3</span><span class="o">)</span> <span class="o">==</span> <span class="m">5</span>
E       assert <span class="nv">4</span> <span class="o">==</span> <span class="m">5</span>
E        +  where <span class="nv">4</span> <span class="o">=</span> inc<span class="o">(</span><span class="m">3</span><span class="o">)</span>

test_sample.py:6: <span class="nv">AssertionError</span>
<span class="o">=========================</span> short <span class="nb">test</span> summary <span class="nv">info</span> <span class="o">==========================</span>
FAILED test.py::test_answer - assert <span class="nv">4</span> <span class="o">==</span> <span class="nv">5</span>
<span class="o">============================</span> <span class="m">1</span> failed <span class="k">in</span> <span class="m">0</span>.12s <span class="o">=============================</span>
</pre></div>
</div>
<p>As you add more tests, they will be automatically picked up and run by <code class="docutils literal notranslate"><span class="pre">pytest</span></code>.</p>
<p>When writing tests, think about whether you have tested realistic combinations of input parameters, tested all discrete outputs at least once, tested the boundaries of continuous outputs, and ensured that informative errors are raised when things go wrong.</p>
<p>If you’re using Visual Studio Code, support for <strong>pytest</strong> comes built-in.</p>
<div class="section" id="testing-continuous-variables">
<h3>Testing continuous variables<a class="headerlink" href="#testing-continuous-variables" title="Permalink to this headline">¶</a></h3>
<p>Imagine we are not testing for an integer, such as 4, but instead for a real number, such as 4.32838. Computers are nothing if not punishingly literal, however, so if evaluation of the code produces 4.32837 instead of 4.32838 the <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement will fail and the test won’t pass even if the two numbers are close enough for our purposes. It’s even worse than that because computers <em>cannot</em> accurately represent real numbers to arbitrary levels of precision.</p>
<p>To avoid tests that fail even though nothing’s really wrong, most testing packages come with tools for real numbers. Here’s an example where we have a parameter alpha that we’d like to test against an expected value of 1 but with a tolerance of 0.01.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>


<span class="k">def</span> <span class="nf">complicated_func</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A really complicated func&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">0.998</span>


<span class="n">alpha</span> <span class="o">=</span> <span class="n">complicated_func</span><span class="p">()</span>
<span class="n">expected_alpha</span> <span class="o">=</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">abs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">alpha</span> <span class="o">==</span> <span class="n">expected_alpha</span>
<span class="nb">print</span><span class="p">(</span><span class="n">expected_alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0 ± 1.0e-02
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="test-coverage">
<h3>Test coverage<a class="headerlink" href="#test-coverage" title="Permalink to this headline">¶</a></h3>
<p>A production-ready code should be heavily tested. Coverage tests ask how much of your code is actually covered by tests and where the code is that isn’t tested. One package to do this is called <a class="reference external" href="https://coverage.readthedocs.io/en/coverage-5.5/"><strong>coverage</strong></a>. If you already have code tests written, you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>coverage run -m pytest
</pre></div>
</div>
<p>on the command line instead of just running <code class="docutils literal notranslate"><span class="pre">pytest</span></code>. To get a report on the success use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ coverage report -m
Name                      Stmts   Miss  Cover   Missing
-------------------------------------------------------
my_program.py                <span class="m">20</span>      <span class="m">4</span>    <span class="m">80</span>%   <span class="m">33</span>-35, <span class="m">39</span>
my_other_module.py           <span class="m">56</span>      <span class="m">6</span>    <span class="m">89</span>%   <span class="m">17</span>-23
-------------------------------------------------------
TOTAL                        <span class="m">76</span>     <span class="m">10</span>    <span class="m">87</span>%
</pre></div>
</div>
<p>If you would prefer a html report over one in the terminal, use <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">coverage</span> <span class="pre">html</span></code> to create a report at <code class="docutils literal notranslate"><span class="pre">htmlcov/index.html</span></code>.</p>
</div>
</div>
<div class="section" id="type-annotations-and-type-checkers">
<h2>Type annotations and type checkers<a class="headerlink" href="#type-annotations-and-type-checkers" title="Permalink to this headline">¶</a></h2>
<p>Type annotations were introduced in Python 3.5 (these notes are written in 3.8). If you’ve seen more low-level languages, typing will be familiar to you. Python uses ‘duck typing’ (“if it walks and quacks like a duck, it is a duck”) which means that if a variable walks like an integer, and talks like an integer, then it gets treated as if it is an integer. Ditto for other variable types. Duck typing is useful if you just want to code quickly and aren’t writing production code.</p>
<p>But… there are times when you <em>do</em> know what variable types you’re going to be dealing with ahead of time and you want to prevent the propagation of the wrong kinds of variable types. In these situations, you can clearly say what variable types are supposed to be. And, when used with some other packages, typing can make code easier to understand, debug, and maintain.</p>
<p>Note that it doesn’t have to be all or nothing on type checking, you can just add it in gradually or where you think it’s most important.</p>
<p>Now it’s important to be really clear on one point, namely that <em>Python does <strong>not</strong> enforce type annotations</em>. But we can use <em>static type checking</em> to ensure all types are as they should be in <em>advance</em> of running. Before we do that, let’s see how we add type annotations.</p>
<p>This is the simplest example of a type annotation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</div>
<p>This explicitly says that <code class="docutils literal notranslate"><span class="pre">answer</span></code> is an integer. Type annotations can be used in functions too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>A static type checker uses these type annotations to verify the type correctness of a programme without executing it. <a class="reference external" href="http://mypy-lang.org/"><strong>mypy</strong></a> is the most widely used static type checker. After installing <strong>mypy</strong>, to run type checking on a file <code class="docutils literal notranslate"><span class="pre">code_script.py</span></code> use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mypy code_script.py
</pre></div>
</div>
<p>on the command line.</p>
<p>What do you see when you run it? Let’s say the content of your script is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Contents of code_script.py</span>
<span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>


<span class="n">greeting</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>This would return:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Argument <span class="m">1</span> to <span class="s2">&quot;greeting&quot;</span> has incompatible <span class="nb">type</span> <span class="s2">&quot;int&quot;</span><span class="p">;</span> expected <span class="s2">&quot;str&quot;</span>
</pre></div>
</div>
<p>Here are more of the type annotations that you might need or come across, courtesy of the <a class="reference external" href="http://mypy-lang.org/"><strong>mypy</strong></a> documentation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># For simple built-in types, just use the name of the type</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;test&quot;</span>

<span class="c1"># For collections, the type of the collection item is in brackets</span>
<span class="c1"># (Python 3.9+ only)</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">}</span>

<span class="c1"># In Python 3.8 and earlier, the name of the collection type is</span>
<span class="c1"># capitalized, and the type is imported from &#39;typing&#39;</span>
<span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">}</span>

<span class="c1"># Same as above, but with type comment syntax (Python 3.5 and earlier)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># type: List[int]</span>

<span class="c1"># For mappings, we need the types of both keys and values</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>  <span class="c1"># Python 3.9+</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>

<span class="c1"># For tuples of fixed size, we specify the types of all the elements</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>  <span class="c1"># Python 3.9+</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>

<span class="c1"># For tuples of variable size, we use one type and ellipsis</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># Python 3.9+</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Use Optional[] for values that could be None</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_function</span><span class="p">()</span>
<span class="c1"># Mypy understands a value can&#39;t be None in an if-statement</span>
<span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="c1"># If a value can never be None due to some invariants, use an assert</span>
<span class="k">assert</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="timing-and-profiling">
<h2>Timing and profiling<a class="headerlink" href="#timing-and-profiling" title="Permalink to this headline">¶</a></h2>
<p>Timing and profiling your code are useful to understand where bottlenecks might be. One of the principles of programming is don’t optimise too soon, so, if you are reaching for timing and profiling, you’ve probably already hit that bottleneck.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section just deals with diagnosing slow code: how to speed code up will be covered elsewhere.</p>
</div>
<p>There are different levels of sophistication for timing and profiling. The simplest way to time is to use the built-in library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">timeit</span>


<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function sleeps for nsec seconds.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>


<span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
<span class="n">f</span><span class="p">()</span>
<span class="n">elapsed</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
<span class="n">elapsed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0003115839999999
</pre></div>
</div>
</div>
</div>
<p>If you’re working jupyter notebooks (which is what this book is written in), you can use the <code class="docutils literal notranslate"><span class="pre">timeit</span></code> magic, a convenient shortcut for timing a line or chunk of code (more on magics, and timeit, <a class="reference external" href="https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-time">here</a>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> f(0.01)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>11.3 ms ± 253 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>timeit will adjust the number of repeats according to how slow the code is to run. Several other magics are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%time</span></code>: Time the execution of a single statement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%timeit</span></code>: Time repeated execution of a single statement for more accuracy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%prun</span></code>: Run code with the profiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%lprun</span></code>: Run code with the line-by-line profiler</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%memit</span></code>: Measure the memory use of a single statement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%mprun</span></code>: Run code with the line-by-line memory profiler</p></li>
</ul>
<p>Another way to time functions is via decorators:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_time</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">timeit</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">func</span>


<span class="nd">@process_time</span>
<span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">nsec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function sleeps for nsec seconds.&quot;&quot;&quot;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">nsec</span><span class="p">)</span>


<span class="n">f1</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0046072460000008
</pre></div>
</div>
</div>
</div>
<p>Timing is very simple and just tells you the total time of what’s inbetween the start and end points. Often, you would want a bit more detail about what’s being slow, or you may wish to profile an entire script. For that, there’s <code class="docutils literal notranslate"><span class="pre">cProfile</span></code>, which is a built-in package. You can use it on the command line or within scripts, like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">cProfile</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>


<span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;foo()&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         6 function calls in 3.505 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    3.505    3.505 487730401.py:5(foo)
        1    0.000    0.000    3.505    3.505 &lt;string&gt;:1(&lt;module&gt;)
        1    0.000    0.000    3.505    3.505 {built-in method builtins.exec}
        2    3.505    1.753    3.505    1.753 {built-in method time.sleep}
        1    0.000    0.000    0.000    0.000 {method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects}
</pre></div>
</div>
</div>
</div>
<p>What do we get here? The <code class="docutils literal notranslate"><span class="pre">percall</span></code> columns are <code class="docutils literal notranslate"><span class="pre">tottime</span></code> and <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> (respectively) divided by <code class="docutils literal notranslate"><span class="pre">ncalls</span></code>. <code class="docutils literal notranslate"><span class="pre">tottime</span></code> is the time spent in the function excluding any sub-functions, while <code class="docutils literal notranslate"><span class="pre">cumtime</span></code> is the cumulative time spent.</p>
<p>There are various profilers out there that extend the basics provided by <strong>cProfile</strong>. Let’s look at a few others to get a sense of what extra they offer.</p>
<p><a class="reference external" href="https://github.com/joerick/pyinstrument"><strong>pyinstrument</strong></a> attempts to improve on the standard profilers by recording the ‘entire stack’ of methods so that identifying expensive sub-calls to methods is easier. There are two ways to run it: on the command line, using <code class="docutils literal notranslate"><span class="pre">pyinstrument</span> <span class="pre">script.py</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">script.py</span></code>, or by wedging the code you’re interested in <em>within</em> a script between a <code class="docutils literal notranslate"><span class="pre">.start()</span></code> and <code class="docutils literal notranslate"><span class="pre">.stop()</span></code> method like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyinstrument</span> <span class="kn">import</span> <span class="n">Profiler</span>


<span class="n">profiler</span> <span class="o">=</span> <span class="n">Profiler</span><span class="p">()</span>
<span class="n">profiler</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;n must be a positive integer&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">fibonacci</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">profiler</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># Print the results of the profiling to screen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">profiler</span><span class="o">.</span><span class="n">output_text</span><span class="p">(</span><span class="n">unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  _     ._   __/__   _ _  _  _ _/_   Recorded: 22:29:09  Samples:  3
 /_//_/// /_\ / //_// / //_&#39;/ //     Duration: 0.004     CPU time: 0.004
/   _/                      v4.0.4

Program: /opt/anaconda3/envs/codeforecon/lib/python3.8/site-packages/ipykernel_launcher.py -f /private/var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/tmpd0xmss6f.json --HistoryManager.hist_file=:memory:

<span class=" -Color -Color-Red">0.003</span> run_code  <span class=" -Color -Color-Faint">IPython/core/interactiveshell.py:3400</span>
└─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">&lt;module&gt;</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:19</span>
   └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
      └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
         └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
            └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
               └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                  └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                     └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                        └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                           └─ <span class=" -Color -Color-Red">0.003</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              ├─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │  └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │     └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │        └─ <span class=" -Color -Color-Red">0.002</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │           ├─ <span class=" -Color -Color-Yellow">0.001</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │           │  └─ <span class=" -Color -Color-Yellow">0.001</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │           │     └─ <span class=" -Color -Color-Yellow">0.001</span> <span class=" -Color -Color-C15 -Color-C15-BGC24">fibonacci</span>  <span class=" -Color -Color-Faint">../../../var/folders/x6/ffnr59f116l96_y0q0bjfz7c0000gn/T/ipykernel_53160/4099532080.py:8</span>
                              │           └─ <span class=" -Color -Color-Yellow">0.001</span> [self]  
                              └─ <span class=" -Color -Color-Yellow">0.001</span> [self]  
</pre></div>
</div>
</div>
</div>
<p>Because our function, <code class="docutils literal notranslate"><span class="pre">fibonacci</span></code>, is nested, the function call breakdown that <strong>pyinstrument</strong> produces is likewise nested so that you can see how the code calls progresses.</p>
<p>The output analysis can be written to an interactive HTML file too: just use <code class="docutils literal notranslate"><span class="pre">profiler.output_html()</span></code></p>
<p>Time to execute code is not the only thing we care about. In fact, for economics applications, it’s much more likely to be a memory bottleneck than a speed one. Operations that involve lots of data, large matrices, or both, might be memory hogs. If you hit the memory (RAM) limit on your machine, it will slow right down and the process that’s running might just crash completely. So wouldn’t it be great it we had a way to profile both code and memory!? Well, we do.</p>
<p><a class="reference external" href="https://github.com/plasma-umass/scalene"><strong>scalene</strong></a> is a command-line utility for profiling code execution time <em>and</em> memory. It profiles whole scripts, run <code class="docutils literal notranslate"><span class="pre">scalene</span> <span class="pre">script.py</span></code> on the command line, and produces HTML reports. Here’s an example of some output:</p>
<p><img alt="Screenshot from scalene running on a problem" src="https://raw.githubusercontent.com/plasma-umass/scalene/master/docs/images/sample-profile-pystone.png" /></p>
<p>What’s particularly useful is having the part of the code where the bottleneck is displayed on the right. Memory usage over time tells you where the memory-hogging lines are, while the two CPU % columns tell you how much of the total time (shown at the top) was spent in Python code and in non-Python (‘native’) code, which Python often calls under the hood.</p>
</div>
<div class="section" id="i-am-the-walrus">
<h2>I am the Walrus<a class="headerlink" href="#i-am-the-walrus" title="Permalink to this headline">¶</a></h2>
<p>The Walrus operator, <code class="docutils literal notranslate"><span class="pre">:=</span></code> was introduced in Python 3.8 and, well, it’s fairly complicated but it <em>does</em> have its uses. The main use case for the Walrus operator is when you want to both <em>evaluate an expression</em> and <em>assign a variable</em> in one fell swoop.</p>
<p>Take this (trivial) example which involves evaluating an expression, <code class="docutils literal notranslate"><span class="pre">len(a)</span> <span class="pre">&gt;</span> <span class="pre">4</span></code>, that returns a boolean and then assigning that <em>same</em> expression to a variable <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List is too long (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> elements, expected &lt;= 3)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List is too long (4 elements, expected &lt;= 3)
</pre></div>
</div>
</div>
</div>
<p>The Walrus operator allows us to skip the clumsy use of <code class="docutils literal notranslate"><span class="pre">len(a)</span></code> twice and do both steps in one go. As noted, that’s trivial here, but if evaluation were very computationally expensive, then this might save us some trouble. Here’s the version with the Walrus operator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">:=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;List is too long (</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> elements, expected &lt;= 3)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>List is too long (4 elements, expected &lt;= 3)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="multiple-dispatch">
<h2>Multiple dispatch<a class="headerlink" href="#multiple-dispatch" title="Permalink to this headline">¶</a></h2>
<p>One can use object-oriented methods and inheritance to get different code objects to behave in different ways depending on the type of input. For example, a different behaviour might occur if you send a string into a function versus an integer. An alternative to the object-oriented approach is to use <em>multiple dispatch</em>. <a class="reference external" href="https://fastcore.fast.ai/"><strong>fastcore</strong></a> is a library that provides “goodies to make your coding faster, easier, and more maintainable” and has many neat features but amongst the ‘goodies’ is multiple dispatch, with the <code class="docutils literal notranslate"><span class="pre">typedispatch</span></code> decorator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fastcore is designed to be imported as *</span>
<span class="kn">from</span> <span class="nn">fastcore.dispatch</span> <span class="kn">import</span> <span class="o">*</span>


<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">func_example</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>


<span class="nd">@typedispatch</span>
<span class="k">def</span> <span class="nf">func_example</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>


<span class="c1"># Int and float</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func_example</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">))</span>

<span class="c1"># Int and int</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func_example</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.0
25
</pre></div>
</div>
</div>
</div>
<p>What we can see here is that we have the same function, <code class="docutils literal notranslate"><span class="pre">func_example</span></code>, used twice with <em>very</em> similar inputs. But the inputs are <em>not</em> the same; in the first instance it’s an integer and a float while in the second it’s two integers. The different inputs get routed into the different versions of the <code class="docutils literal notranslate"><span class="pre">&#64;typeddispatch</span></code> function. This decorator-based approach is not the only way to use <strong>fastcore</strong> to do typed dispatch but it’s one of the most convenient.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="code-basics.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Basics of Coding</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="code-where.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Options for Writing Code</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Arthur Turrell<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            This book is available under an MIT license.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-189705534-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>